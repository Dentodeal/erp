(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{a3a2:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("page-toolbar",{attrs:{buttons:t.toolbarButtons},on:{save:function(e){return t.saveFn()}}}),s("breadcrumbs",{attrs:{breadcrumbs:t.breadcrumbs}}),s("div",{class:t.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[s("q-card",[s("q-card-section",[s("div",{class:t.$q.screen.gt.sm?"row q-col-gutter-md":"row q-col-gutter-xs"},[s("div",{class:t.$q.screen.gt.sm?"col-md-6 col-12 q-mt-md":"col-md-6 col-12 q-mt-xs"},[s("q-input",{ref:"name",attrs:{"error-message":t.errors.name,error:t.errors.name&&t.errors.name.length>0,dense:"",outlined:"",square:"",label:"Name",rules:[function(t){return!!t||"Required"}]},on:{input:function(e){t.errors.name=null}},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name",e)},expression:"model.name"}})],1)]),s("div",{staticClass:"row q-mt-md"},[s("div",{staticClass:"col"},[s("q-table",{attrs:{columns:t.columns,title:"Items",data:t.model.items,"row-key":"sl_no","wrap-cells":"",loading:t.table_loading,"rows-per-page-options":[0],filter:t.search},scopedSlots:t._u([{key:"body",fn:function(e){return[s("q-tr",{attrs:{props:e}},[s("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),s("q-td",[t._v("\n                      "+t._s(e.row.product.name)+"\n                      "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close"},on:{show:function(){t.product=e.row.product},hide:function(){t.product=null}},model:{value:e.row.product.name,callback:function(s){t.$set(e.row.product,"name",s)},expression:"props.row.product.name"}},[s("q-select",{attrs:{outlined:"",square:"",dense:"",label:"Product",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand",options:t.productOptions,"use-input":"","fill-input":"","hide-selected":"",loading:t.prodLoading,"option-value":"id","option-label":"name"},on:{filter:t.productFilter,input:function(s){e.row.product.name=t.product.name,e.row.product_id=t.product.id}},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                                      No results\n                                      ")])],1)]},proxy:!0}],null,!0),model:{value:t.product,callback:function(e){t.product=e},expression:"product"}})],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                      "+t._s(e.row.qty)+"\n                      "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(e){return!0===t.qtyEditValidation(e)}},on:{hide:function(t){e.row.qty=parseInt(e.row.qty)}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}},[s("q-input",{ref:"qty_edit",attrs:{rules:[t.qtyEditValidation],dense:"",autofocus:""},on:{input:function(e){return t.$refs.qty_edit.resetValidation()}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}})],1)],1),s("q-td",{staticClass:"text-right"},[s("q-btn",{attrs:{round:"",icon:"delete",flat:"",color:"black"},on:{click:function(s){return t.deleteFn(e.rowIndex)}}})],1)],1)]}},{key:"top-right",fn:function(){return[s("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})]},proxy:!0}])})],1)]),s("div",{staticClass:"row q-col-gutter-xs q-mt-xs"},[s("div",{staticClass:"col-9"},[s("q-select",{ref:"product",attrs:{outlined:"",square:"",dense:"",label:"Product",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand",options:t.productOptions,"option-value":"id","option-label":"name","use-input":"","fill-input":"","hide-selected":"",loading:t.prodLoading},on:{filter:t.productFilter,"input-value":function(e){return t.$refs.product.resetValidation()}},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                            No results\n                            ")])],1)]},proxy:!0}]),model:{value:t.product,callback:function(e){t.product=e},expression:"product"}})],1),s("div",{staticClass:"col-2"},[s("q-input",{ref:"qty",staticClass:"input-right",attrs:{outlined:"",square:"",dense:"",label:"Qty",rules:[t.qtyValidation],"lazy-rules":"ondemand"},on:{focus:function(e){t.qty&&e.target.select()},blur:function(){t.qty=t.qty?parseInt(t.qty).toString():null},input:function(e){return t.$refs.qty.resetValidation()}},model:{value:t.qty,callback:function(e){t.qty=e},expression:"qty"}})],1),s("div",{},[s("q-btn",{attrs:{icon:"add",round:"",flat:"",color:"teal"},on:{click:function(e){return t.addRow()}}})],1)])])],1)],1),s("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:t.toolbarButtons},on:{save:function(e){return t.saveFn()}}})],1)},a=[],n=(s("c975"),s("a434"),s("e6cf"),s("a79d"),s("5319"),s("a89c")),r=s("b6c6"),i={name:"ProductBundlesCreate",components:{PageToolbar:n["a"],Breadcrumbs:r["a"]},data(){return{model:{name:null,items:[]},search:null,table_loading:!1,prodLoading:!1,product:null,productOptions:[],qty:null,errors:{name:null},toolbarButtons:[{label:"Save",id:"save",type:"button",color:"teal",icon:"save"}]}},computed:{breadcrumbs(){const t=[{label:"Dashboard",link:"/"},{label:"Product Bundles",link:"/product_bundles"},{label:this.$route.params.id?this.model.name:"Create",link:"/product_bundles/view/"+this.$route.params.id}];return this.$route.params.id&&t.push({label:"Edit",link:""}),t},columns(){const t=[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"actions",field:"actions",label:"",sortable:!1}];return t}},mounted(){this.$store.getters.hasPermissionTo("create_product")?this.$route.params.id&&(this.$q.loading.show(),this.$axios.get("product_bundles/"+this.$route.params.id).then((t=>{this.model=t.data})).finally((()=>{this.$q.loading.hide()}))):this.$router.push({name:"Error403"})},methods:{addRow(){this.$refs.product.validate()&this.$refs.qty.validate()&&this.addItem(this.qty),this.product=null,this.qty=null,this.$nextTick((()=>{this.$refs.product.focus()}))},addItem(t){t=parseInt(t),this.model.items.push({product:{name:this.product.name},product_id:this.product.id,qty:t})},deleteFn(t){this.$q.dialog({title:"Confirm",message:"Would you like to delete this record?",cancel:!0,persistent:!0}).onOk((()=>{this.model.items[t].id?this.$axios.get("product_bundles/delete_item/"+this.model.items[t].id).then((e=>{"success"===e.data.message&&this.model.items.splice(t,1)})):this.model.items.splice(t,1)})).onCancel((()=>{}))},qtyValidation(){return null===this.qty||""===this.qty?"Required":isNaN(this.qty)?"Invalid":!(parseInt(this.qty)<=0)||"Qty must be greater than 0"},qtyEditValidation(t){return t?isNaN(t)?"invalid":!!Number.isInteger(Number(t))||"Must be Integer":"Required"},productFilter(t,e,s){e((()=>{t&&(this.prodLoading=!0,this.$axios.get("products/search?keyword="+encodeURIComponent(t)).then((t=>{this.productOptions=t.data})).finally((()=>{this.prodLoading=!1})))}))},saveFn(){if(this.$refs.name.validate()&this.validateItemsCount()){const t=this.model;t._method=this.$route.params.id?"PUT":"POST";let e="product_bundles";this.$route.params.id&&(e="product_bundles/"+this.$route.params.id),this.$q.loading.show(),this.$axios.post(e,t).then((t=>{"success"===t.data.message&&(this.$q.loading.hide(),this.$q.notify({type:"positive",message:"Saved Succesfully."}),this.$router.replace("/product_bundles/view/"+t.data.id))})).catch((t=>{if(this.$q.loading.hide(),422===t.response.status){this.$q.notify({type:"negative",message:t.response.data.message});let e="";Object.keys(t.response.data.errors).forEach((s=>{-1!==s.indexOf("items")&&(e+="<p>Line "+(parseInt(s.substr(s.indexOf(".")+1))+1)+":"+t.response.data.errors[s][0]+"</p><br>"),-1!==s.indexOf("name")&&(this.errors.name=t.response.data.errors[s][0])})),e&&this.$q.dialog({style:{width:"50%",maxWidth:"100%"},title:"Cannot process this Sale Order",message:e,html:!0})}})).finally((()=>{this.$q.loading.hide()}))}else this.$q.notify({type:"negative",message:"Invalid data given !!!"})},validateItemsCount(){return this.model.items.length>0||(this.$q.notify({type:"negative",message:"There should be atleast one item"}),!1)}}},l=i,d=s("2877"),u=s("9989"),c=s("f09f"),p=s("a370"),m=s("27f9"),h=s("eaac"),q=s("bd08"),b=s("db86"),f=s("42a1"),y=s("ddd8"),g=s("66e5"),v=s("4074"),$=s("9c40"),w=s("0016"),x=s("eebe"),_=s.n(x),k=Object(d["a"])(l,o,a,!1,null,null,null);e["default"]=k.exports;_()(k,"components",{QPage:u["a"],QCard:c["a"],QCardSection:p["a"],QInput:m["a"],QTable:h["a"],QTr:q["a"],QTd:b["a"],QPopupEdit:f["a"],QSelect:y["a"],QItem:g["a"],QItemSection:v["a"],QBtn:$["a"],QIcon:w["a"]})}}]);