(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[47],{a8a6:function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[s("page-toolbar",{attrs:{"page-title":"Phones",buttons:e.toolbarButtons},on:{create:e.createFn}}),s("breadcrumbs",{attrs:{breadcrumbs:e.breadcrumbs}}),s("advanced-data-table",{ref:"advancedDataTable",attrs:{"server-sync":"",route:"phones","page-preferences":e.pagePreferences,"edit-permission":"update_phone","delete-permission":"delete_phone","page-edit":!0},on:{"edit-fn":e.editFn}}),s("q-dialog",{attrs:{persistent:""},model:{value:e.createDialog,callback:function(t){e.createDialog=t},expression:"createDialog"}},[s("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[s("q-card-section",{staticClass:"row items-center q-pb-none"},[e.edit_mode?s("div",[e._v("Edit phone: "+e._s(e.phone))]):s("div",[e._v("Create new phone")]),s("q-space"),s("q-btn",{attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:function(t){return e.closeCreateDialog()}}})],1),s("q-card-section",[s("div",{staticClass:"row q-mt-sm"},[s("div",{staticClass:"col-2"},[s("q-select",{attrs:{outlined:"",square:"",options:e.countryCodeOptions,label:"Code","emit-value":"","map-options":""},model:{value:e.country_code,callback:function(t){e.country_code=t},expression:"country_code"}})],1),s("div",{staticClass:"col-10"},[s("q-input",{ref:"phone",attrs:{label:"Phone",outlined:"",square:"",rules:[function(e){return!!e||"Required"},function(e){return Number.isInteger(Number(e))||"Invalid"}],error:e.phoneError,"error-message":e.phoneErrorMessage},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1)]),s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-input",{attrs:{outlined:"",square:"",label:"Source"},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}})],1)]),s("div",{staticClass:"row q-mt-md"},[s("div",{staticClass:"col"},[s("q-select",{attrs:{square:"",outlined:"",label:"Tags",options:e.tagOptions,"use-input":"","use-chips":"",multiple:"","input-debounce":"0"},on:{"new-value":e.newTag,filter:e.tagFilterFn},model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}})],1)])]),s("q-card-actions",[s("q-btn",{attrs:{label:"Save",color:"green-10",icon:"save"},on:{click:function(t){return e.saveFn()}}}),s("q-btn",{attrs:{label:"cancel",color:"secondary",flat:""},on:{click:function(t){return e.closeCreateDialog()}}})],1)],1)],1)],1)},a=[],n=(s("fb6a"),s("498a"),s("a89c")),i=s("b6c6"),r=s("ab3c"),c={name:"PhonesIndex",components:{PageToolbar:n["a"],Breadcrumbs:i["a"],AdvancedDataTable:r["a"]},data(){return{edit_mode:!1,edit_id:null,phone:null,phoneError:null,phoneErrorMessage:"",country_code:"+91",tags:[],tagOptions:[],source:null,createDialog:!1,breadcrumbs:[{label:"Dashboard",link:"/"},{label:"Phones",link:"/phones"}],pagePreferences:{page_index_visible_columns:"phones_index_visible_columns",page_index_pagination:"phones_index_pagination",page_index_search:"phones_index_search",page_index_autosearch:"phones_index_autosearch",page_index_filtered:"phones_index_filtered"},countryCodeOptions:[]}},mounted(){this.$store.commit("setPageTitle","Phones")},computed:{toolbarButtons(){const e=[];return this.$store.getters.hasPermissionTo("create_phone")&&e.push({label:"Create",id:"create",type:"button",color:"teal",icon:"add"}),e}},methods:{createFn(){0===this.countryCodeOptions.length&&this.$axios.get("phonecodes").then((e=>{this.countryCodeOptions=e.data})),this.resetForm(),this.edit_mode=!1,this.createDialog=!0,this.$nextTick((()=>{this.$refs.phone.focus()}))},editFn(e){0===this.countryCodeOptions.length&&this.$axios.get("phonecodes").then((e=>{this.countryCodeOptions=e.data})),this.resetForm(),this.edit_id=e.id,this.phone=e.content,this.source=e.source,this.tags=e.tags.split(","),this.edit_mode=!0,this.createDialog=!0,this.$nextTick((()=>{this.$refs.phone.focus(),this.$refs.phone.select()}))},closeCreateDialog(){this.resetForm(),this.edit_id=null,this.edit_mode=!1,this.createDialog=!1},resetForm(){this.phone=null,this.phoneError=!1,this.phoneErrorMessage="",this.country_code="+91",this.tags=[],this.tagOptions=[],this.source=null},saveFn(){if(this.$refs.phone.validate()){this.phoneError=!1,this.phoneErrorMessage="";let e="phones";this.edit_mode&&(e="phones/"+this.edit_id);const t={content:this.phone,country_code:this.country_code,_method:this.edit_mode?"PUT":"POST",tags:this.tags,source:this.source};this.$q.loading.show(),this.$axios.post(e,t).then((e=>{"success"===e.data.message&&(this.$q.loading.hide(),this.$q.notify({type:"positive",message:"Data Saved Successfully"}),this.closeCreateDialog(),this.refreshFn())})).catch((e=>{this.$q.loading.hide(),422===e.response.status&&(this.$q.notify({type:"negative",message:e.response.data.message}),this.phoneError=!0,this.phoneErrorMessage=e.response.data.errors.content[0])}))}},refreshFn(){const e=this.$refs.advancedDataTable;e.getDataFromApi({pagination:e.pagination,filter:e.search})},tagFilterFn(e,t,s,o){t((()=>{if(e){const t="";this.$axios.get("tag_search?"+t+"&search="+encodeURIComponent(e)).then((e=>{this.tagOptions=e.data}))}}))},newTag(e,t){if(e.length>0){const s=(this.tags||[]).slice();e.split(/[,;|]+/).map((e=>e.trim())).filter((e=>e.length>0)).forEach((e=>{!1===s.includes(e)&&s.push(this.capitaliseFn(e))})),t(null),this.tags=s}},capitaliseFn(e){if(e){const t=e.split(" ");for(let e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].substring(1);return t.join(" ")}return""}}},l=c,d=s("2877"),h=s("9989"),p=s("24e8"),u=s("f09f"),g=s("a370"),m=s("2c91"),b=s("9c40"),_=s("ddd8"),f=s("27f9"),v=s("4b7e"),q=s("eebe"),x=s.n(q),C=Object(d["a"])(l,o,a,!1,null,null,null);t["default"]=C.exports;x()(C,"components",{QPage:h["a"],QDialog:p["a"],QCard:u["a"],QCardSection:g["a"],QSpace:m["a"],QBtn:b["a"],QSelect:_["a"],QInput:f["a"],QCardActions:v["a"]})}}]);