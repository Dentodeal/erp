(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[89],{de7f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("page-toolbar",{attrs:{buttons:t.toolbarButtons},on:{sendtoaccounts:function(e){return t.sendtoaccounts()},invoice:function(e){t.settlementDialog=!0},requestapproval:function(e){return t.requestapproval()},approve:function(e){return t.approve()},reject:function(e){return t.reject()},cancel:function(e){return t.cancel()},complete:function(e){return t.complete()},revert:function(e){return t.revert()},download:function(e){return t.download()},sendforconfirmation:function(e){return t.sendforconfirmation()},confirm:function(e){return t.confirm()},salereturn:function(e){t.saleReturnDialog=!0}}}),a("breadcrumbs",{attrs:{breadcrumbs:t.breadcrumbs}}),t.return_count>0?a("q-toolbar",{staticClass:"q-px-lg"},[a("q-space"),a("q-btn",{attrs:{depressed:"",color:"cyan-7",label:"sale returns",to:"/sale_orders/returns/"+t.$route.params.id}},[a("q-badge",{staticClass:"text-black q-ml-sm",attrs:{color:"white"}},[t._v(t._s(t.return_count))])],1)],1):t._e(),a("div",{class:t.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[a("div",{staticClass:"row q-col-gutter-md q-pa-md "},[a("div",{staticClass:"col-12 col-md-6"},[a("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[a("tbody",[a("tr",[a("td",[t._v("Serial No")]),a("td",[t._v(t._s(t.serial_no))])]),a("tr",[a("td",[t._v("Customer")]),a("td",[a("router-link",{attrs:{to:"/customers/view/"+t.customer.id}},[t._v(t._s(t.customer.name))])],1)]),a("tr",[a("td",[t._v("Warehouse")]),a("td",[t._v(t._s(t.warehouse.name))])]),a("tr",[a("td",[t._v("Pricelist")]),a("td",[t._v(t._s(t.pricelist.name))])]),a("tr",[a("td",[t._v("Source")]),a("td",[t._v(t._s(t.source))])]),t.shipment?a("tr",[a("td",[t._v("Shipment")]),a("td",[a("router-link",{attrs:{to:"/shipments/view/"+t.shipment.id}},[t._v(t._s(t.shipment.serial_no))])],1)]):t._e(),t.cod?a("tr",[a("td",{attrs:{colspan:"2"}},[a("div",{staticClass:"text-h5 text-center"},[t._v("COD")])])]):t._e()])])],1),a("div",{staticClass:"col-12 col-md-6"},[a("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[a("tbody",[a("tr",[a("td",[t._v("Status")]),a("td",[t._v(t._s(t.status))])]),a("tr",[a("td",[t._v("Created By")]),a("td",[t._v(t._s(t.created_by.name))])]),a("tr",[a("td",[t._v("Representative")]),a("td",[t._v(t._s(t.representative.name))])]),a("tr",[a("td",[t._v("Created At")]),a("td",[t._v(t._s(t.getLocaleString(t.created_at)))])]),a("tr",[a("td",[t._v("Invoiced At")]),a("td",[t._v(t._s(t.getLocaleString(t.invoiced_at)))])]),t.invoiced_by?a("tr",[a("td",[t._v("Invoiced By")]),a("td",[t._v(t._s(t.invoiced_by.name))])]):t._e(),t.order_no?a("tr",[a("td",[t._v("Order No")]),a("td",[t._v(t._s(t.order_no))])]):t._e(),t.quotation?a("tr",[a("td",[t._v("Quotation")]),a("td",[a("router-link",{attrs:{to:"/quotations/view/"+t.quotation.id}},[t._v(t._s(t.quotation.serial_no))])],1)]):t._e()])])],1)]),t.billingAddress&&"OTC"!=t.customer.name?a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-md-6 q-mt-md q-pa-sm"},[a("q-card",[a("q-card-section",{staticClass:"bg-blue-10 text-white"},[a("div",{staticClass:"text-subtitle2 "},[t._v("Billing Address")])]),a("q-card-section",[a("div",{staticClass:"text-subtitle1"},[t._v(t._s(t.billingAddress))])])],1)],1),a("div",{staticClass:"col-12 col-md-6 q-mt-md q-pa-sm"},[a("q-card",[a("q-card-section",{staticClass:"bg-orange-10 text-white"},[a("div",{staticClass:"text-subtitle2 "},[t._v("Shipping Address")])]),a("q-card-section",[a("div",{staticClass:"text-subtitle1"},[t._v(t._s(t.shippingAddress.content))])])],1)],1)]):t._e(),a("div",{staticClass:"row q-col-gutter-md q-pa-md "},[a("div",{staticClass:"col"},[a("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[a("tbody",[a("tr",[a("td",[t._v("Payment Status:\n                "),a("q-chip",{attrs:{color:t.getPaymentStatusColor(),"text-color":"white"}},[t._v(t._s(t.payment_status))])],1),a("td",[t._v("Paid: "+t._s(t.paid_amount))]),a("td",[t._v("Balance: "+t._s(t.balance_amount))])])])])],1)]),a("div",{staticClass:"row q-col-gutter-md q-pa-md "},[a("div",{staticClass:"col"},[a("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[a("tbody",[a("tr",[a("td",[t._v("Rate Includes GST: "+t._s(t.rate_includes_gst?"Yes":"No"))]),a("td",[t._v("Include Flood Cess ?: "+t._s(t.flood_cess_included?"Yes":"No"))]),a("td",[t._v("OTC: "+t._s(t.otc?"Yes":"No"))]),a("td",[t._v("COD: "+t._s(t.cod?"Yes":"No"))])])])])],1)]),a("div",{staticClass:"row q-col-gutter-md q-pa-md "},[a("div",{staticClass:"col"},[a("q-table",{staticClass:"my-sticky-header-table",attrs:{columns:t.columns,title:"Items",data:t.items,"row-key":"sl_no","wrap-cells":"",loading:t.table_loading,"rows-per-page-options":[0],filter:t.search},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),a("q-td",[a("router-link",{attrs:{to:"/products/view/"+e.row.product.id}},[t._v(t._s(e.row.name))]),a("q-btn",{attrs:{icon:"content_copy",flat:"",round:""},on:{click:function(a){return t.$store.dispatch("copyToClipboard",e.row.name)}}})],1),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.product.weight*e.row.qty).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")]),a("q-td",{staticClass:"text-right"},[e.row.gst?a("div",[t._v("\n                  "+t._s(e.row.gst)+"%\n                ")]):t._e()]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.qty).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.rate).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.expiry_date)+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.is_free?"Yes":"No")+"\n              ")]),t.rate_includes_gst?t._e():a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.taxable).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")]),t.rate_includes_gst?t._e():a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.tax_amount).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(parseFloat(e.row.total).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n              ")])],1)]}},{key:"top-right",fn:function(e){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),a("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:e.toggleFullscreen}})]}},{key:"bottom-row",fn:function(){return[a("q-tr",{staticClass:"bg-blue-grey-3"},[a("q-td",{attrs:{colspan:"1"}}),a("td",{staticClass:"text-right"},[t._v("Total Weight:")]),a("td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.totalWeight).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}))+"gm")]),a("q-td",{attrs:{colspan:t.rate_includes_gst?4:6}}),a("q-td",{staticClass:"text-right"},[t._v("Subtotal")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.subtotal).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1),a("q-tr",{staticClass:"bg-blue-grey-1"},[a("q-td",{attrs:{colspan:t.rate_includes_gst?7:9}}),a("q-td",{staticClass:"text-right"},[t._v("Discount")]),a("q-td",{staticClass:"text-right"},[t._v("-"+t._s(parseFloat(t.discount).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1),t.cod?a("q-tr",{staticClass:"bg-blue-grey-1"},[a("q-td",{attrs:{colspan:t.rate_includes_gst?7:9}}),a("q-td",{staticClass:"text-right"},[t._v("COD Charge")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.cod_charge).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1):t._e(),a("q-tr",{staticClass:"bg-blue-grey-1"},[a("q-td",{attrs:{colspan:t.rate_includes_gst?7:9}}),a("q-td",{staticClass:"text-right"},[t._v("Freight")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.freight).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1),a("q-tr",{staticClass:"bg-blue-grey-1"},[a("q-td",{attrs:{colspan:t.rate_includes_gst?7:9}}),a("q-td",{staticClass:"text-right"},[t._v("Round")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.round).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1),a("q-tr",{staticClass:"bg-blue-grey-3"},[a("q-td",{attrs:{colspan:t.rate_includes_gst?7:9}}),a("q-td",{staticClass:"text-right"},[t._v("Total")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.total).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1)]},proxy:!0}])})],1)]),a("div",{staticClass:"row q-mt-sm"},[a("div",{staticClass:"col q-px-md"},[a("div",{staticClass:"text-h6"},[t._v(" Additional Information")]),a("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell",flat:""}},[a("tbody",[a("tr",[a("td",[t._v("PO Number: "+t._s(t.po_number))]),a("td",[t._v("Order Date: "+t._s(t.order_date))])])])])],1)]),a("div",{staticClass:"row q-mt-sm q-col-gutter-md"},[a("div",{staticClass:"col-12 col-md-6 q-px-md"},[a("div",{staticClass:"text-h6"},[t._v("Remarks")]),a("div",{domProps:{innerHTML:t._s(t.remarks)}})]),a("div",{staticClass:"col-12 col-md-6 q-px-md"},[a("div",{staticClass:"text-h6"},[t._v("Dentodeal Data")]),a("div",{domProps:{innerHTML:t._s(t.dentodeal_data)}})])])]),a("q-dialog",{attrs:{persistent:"",position:"top"},model:{value:t.settlementDialog,callback:function(e){t.settlementDialog=e},expression:"settlementDialog"}},[a("settlement-dialog",{attrs:{status:t.status,customer:t.customer,total:t.total,id:t.$route.params.id,route:"invoice",serial_no:t.serial_no},on:{close:function(e){t.settlementDialog=!1,t.getDataFromApi()}}})],1),a("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:t.toolbarButtons},on:{sendtoaccounts:function(e){return t.sendtoaccounts()},invoice:function(e){t.settlementDialog=!0},requestapproval:function(e){return t.requestapproval()},approve:function(e){return t.approve()},reject:function(e){return t.reject()},cancel:function(e){return t.cancel()},complete:function(e){return t.complete()},revert:function(e){return t.revert()},download:function(e){return t.download()},sendforconfirmation:function(e){return t.sendforconfirmation()},confirm:function(e){return t.confirm()},salereturn:function(e){t.saleReturnDialog=!0}}}),a("q-dialog",{attrs:{position:"top"},model:{value:t.remarkDialog,callback:function(e){t.remarkDialog=e},expression:"remarkDialog"}},[a("q-card",{staticStyle:{width:"500px"}},[a("q-card-section",[a("div",{staticClass:"text-subtitle2"},[t._v("Remarks")]),a("q-editor",{attrs:{rows:"3"},model:{value:t.approveRemark,callback:function(e){t.approveRemark=e},expression:"approveRemark"}})],1),a("q-card-actions",[a("q-btn",{attrs:{color:"green-10",label:"Submit",loading:t.approveLoading},on:{click:t.submitApproval}}),a("q-btn",{attrs:{color:"grey-7",label:"Cancel",flat:""},on:{click:function(e){t.remarkDialog=!1}}})],1)],1)],1),a("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.saleReturnDialog,callback:function(e){t.saleReturnDialog=e},expression:"saleReturnDialog"}},[a("return-dialog",{attrs:{items:t.items,rateIncludesGst:t.rate_includes_gst}})],1),a("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.shipmentSelectionDialog,callback:function(e){t.shipmentSelectionDialog=e},expression:"shipmentSelectionDialog"}},[a("shipment-dialog",{attrs:{items:t.items}})],1)],1)},r=[],i=(a("e6cf"),a("a79d"),a("5319"),a("ddb0"),a("2b3d"),a("a89c")),o=a("b6c6"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"bg-primary"},[a("q-bar",[a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),a("q-card-section",[a("div",{staticClass:"text-h6 text-white"},[t._v("Create Sale Return")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-stepper",{ref:"stepper",attrs:{color:"primary",animated:""},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[a("q-step",{attrs:{name:1,title:"Selection",icon:"check"}},[a("q-table",{attrs:{columns:[{name:"ind",field:"ind",label:"#",align:"right"},{name:"product",field:"product",label:"Product",align:"left",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Expiry Date"}],data:t.items,title:"Please select products to return",selection:"multiple",selected:t.selectedForReturn},on:{"update:selected":function(e){t.selectedForReturn=e}},scopedSlots:t._u([{key:"body-selection",fn:function(e){return[a("q-checkbox",{attrs:{disable:e.row.returned_qty===e.row.qty},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"scope.selected"}})]}},{key:"body-cell-ind",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.rowIndex+1)+"\n            ")])]}},{key:"body-cell-product",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.row.product.name)+"\n              "),e.row.returned_qty>0&&e.row.returned_qty!=e.row.qty?a("q-badge",{attrs:{align:"top",outline:"",color:"primary",label:"Partially Returned"}}):t._e(),e.row.returned_qty>0&&e.row.returned_qty==e.row.qty?a("q-badge",{attrs:{align:"top",outline:"",color:"red",label:"Returned"}}):t._e()],1)]}},{key:"header-selection",fn:function(){},proxy:!0}])}),a("q-stepper-navigation",[a("q-btn",{attrs:{color:"primary",label:"Continue",disable:0==t.selectedForReturn.length},on:{click:function(e){t.step=2,t.updateSubtotal()}}})],1)],1),a("q-step",{attrs:{name:2,title:"Details",icon:"save"}},[a("q-table",{staticClass:"my-sticky-header-table",attrs:{columns:t.columns,title:"Selected Items",data:t.selectedForReturn,"row-key":"sl_no","wrap-cells":"","rows-per-page-options":[0]},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),a("q-td",[t._v("\n                "+t._s(e.row.name)+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.qty)+"\n                "),a("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(a){return!0===t.qtyEditValidation(a,t.selectedForReturn[e.rowIndex].qty)}},on:{hide:function(a){t.updateRow(e.rowIndex),e.row.qty=parseInt(e.row.qty)}},model:{value:e.row.qty,callback:function(a){t.$set(e.row,"qty",a)},expression:"props.row.qty"}},[a("q-input",{ref:"qty_edit",attrs:{rules:[function(a){return t.qtyEditValidation(a,e.row.qty)}],dense:"",autofocus:""},on:{input:function(e){return t.$refs.qty_edit.resetValidation()}},model:{value:e.row.qty,callback:function(a){t.$set(e.row,"qty",a)},expression:"props.row.qty"}})],1)],1),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.expiry_date)+"\n              ")])],1)]}},{key:"bottom-row",fn:function(){return[a("q-tr",{staticClass:"bg-blue-grey-3"},[a("q-td",{attrs:{colspan:"2"}}),a("q-td",{staticClass:"text-right"},[t._v("Subtotal")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.returnSubtotal).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1),a("q-tr",{staticClass:"bg-blue-grey-1"},[a("q-td",{attrs:{colspan:"2"}}),a("q-td",{staticClass:"text-right"},[t._v("Freight")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(t.returnFreight?parseFloat(t.returnFreight).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00")+"\n                "),a("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(){return!!t.$refs.freight_edit.validate()}},on:{hide:function(e){t.returnFreight=parseFloat(t.returnFreight).toFixed(2),t.updateTotal()}},model:{value:t.returnFreight,callback:function(e){t.returnFreight=e},expression:"returnFreight"}},[a("q-input",{ref:"freight_edit",staticClass:"input-right",attrs:{dense:"",autofocus:"",rules:[function(t){return!isNaN(t)||"Invalid"}]},on:{focus:function(e){return t.$refs.freight_edit.select()}},model:{value:t.returnFreight,callback:function(e){t.returnFreight=e},expression:"returnFreight"}})],1)],1)],1),a("q-tr",{staticClass:"bg-blue-grey-3"},[a("q-td",{attrs:{colspan:"2"}}),a("q-td",{staticClass:"text-right"},[t._v("Total")]),a("q-td",{staticClass:"text-right"},[t._v(t._s(parseFloat(t.returnTotal).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})))])],1)]},proxy:!0}])}),a("div",{staticClass:"row q-mt-md"},[a("div",{staticClass:"col"},[a("div",{staticClass:"text-subtitle2"},[t._v("Remarks")]),a("q-editor",{attrs:{rows:"3"},model:{value:t.returnRemarks,callback:function(e){t.returnRemarks=e},expression:"returnRemarks"}})],1)]),a("q-stepper-navigation",[a("q-btn",{attrs:{color:"primary",label:"back"},on:{click:function(e){t.step=1}}}),a("q-btn",{staticClass:"q-ml-md",attrs:{color:"green",label:"Submit"},on:{click:function(e){return t.submitReturn()}}})],1)],1)],1)],1)],1)},l=[],c=(a("c975"),{props:["items","rateIncludesGst"],data(){return{step:1,selectedForReturn:[],returnFreight:0,returnSubtotal:0,returnTotal:0,errorQty:!1,errorMessageQty:"",returnRemarks:"",return_count:0,columns:[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Exp Date",sortable:!0}]}},watch:{returnSubtotal(){this.updateTotal()},returnFreight(){this.updateTotal()}},methods:{updateSubtotal(){let t=0;this.selectedForReturn.forEach((e=>{t+=parseFloat(e.total)})),this.returnSubtotal=t.toFixed(2),this.updateTotal()},updateRow(t){const e=parseFloat(this.selectedForReturn[t].total),a=parseInt(this.selectedForReturn[t].qty),s=parseFloat(this.selectedForReturn[t].rate),r=parseFloat(this.selectedForReturn[t].gst);let i=0;if(this.rateIncludesGst)i=s*a,this.selectedForReturn[t].total=i.toFixed(2);else{let e=0;e=s*a,this.selectedForReturn[t].taxable=e.toFixed(2);const o=e*(r/100);this.selectedForReturn[t].tax_amount=o.toFixed(2),i=e+o,this.selectedForReturn[t].total=i.toFixed(2)}const o=i-e;this.addtoSubtotal(o)},addtoSubtotal(t){this.returnSubtotal=(parseFloat(this.returnSubtotal)+parseFloat(t)).toFixed(2)},updateTotal(){const t=parseFloat(this.returnSubtotal),e=parseFloat(this.returnFreight);let a=0;a=t+e,this.returnTotal=Math.round(a).toFixed(2)},qtyEditValidation(t,e){return t?!!Number.isInteger(Number(t))||"Qty must be an integer":"Required"},submitReturn(){this.$axios.post("sale_returns",{sale_order_id:this.$route.params.id,status:"Draft",items:this.selectedForReturn,freight:this.returnFreight,subtotal:this.returnSubtotal,total:this.returnTotal,remarks:this.returnRemarks}).then((t=>{"success"===t.data.message&&this.$router.push({path:"/sale_returns/view/"+t.data.id})})).catch((t=>{this.$q.notify({type:"negative",message:t.response.data.message});let e="";Object.keys(t.response.data.errors).forEach((a=>{-1!==a.indexOf("items")&&(e+="<p>Line "+(parseInt(a.substr(a.indexOf(".")+1))+1)+":"+t.response.data.errors[a][0]+"</p><br>")})),this.$q.dialog({title:"Error in data submitted",message:e,html:!0})}))}}}),d=c,u=a("2877"),p=a("f09f"),m=a("d847"),h=a("2c91"),_=a("9c40"),g=a("05c0"),b=a("a370"),v=a("f531"),q=a("87fe"),f=a("eaac"),y=a("8f8e"),x=a("db86"),w=a("58a81"),C=a("b19c"),k=a("bd08"),F=a("42a1"),S=a("27f9"),D=a("d66b"),$=a("7f67"),R=a("eebe"),Q=a.n(R),T=Object(u["a"])(d,n,l,!1,null,null,null),P=T.exports;Q()(T,"components",{QCard:p["a"],QBar:m["a"],QSpace:h["a"],QBtn:_["a"],QTooltip:g["a"],QCardSection:b["a"],QStepper:v["a"],QStep:q["a"],QTable:f["a"],QCheckbox:y["a"],QTd:x["a"],QBadge:w["a"],QStepperNavigation:C["a"],QTr:k["a"],QPopupEdit:F["a"],QInput:S["a"],QEditor:D["a"]}),Q()(T,"directives",{ClosePopup:$["a"]});var I=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"bg-blue-7"},[a("q-bar",[a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),a("q-card-section",[a("div",{staticClass:"text-h6 text-white"},[t._v("Split Shipment")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-stepper",{ref:"stepper",attrs:{color:"primary",animated:""},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[a("q-step",{attrs:{name:1,title:"Selection",icon:"check"}},[a("q-table",{attrs:{columns:[{name:"ind",field:"ind",label:"#",align:"right"},{name:"product",field:"product",label:"Product",align:"left",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Expiry Date"}],data:t.items,title:"Please select products for split shipment",selection:"multiple",selected:t.selectedForSplit},on:{"update:selected":function(e){t.selectedForSplit=e}},scopedSlots:t._u([{key:"body-cell-ind",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.rowIndex+1)+"\n            ")])]}},{key:"body-cell-product",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.row.product.name)+"\n            ")])]}}])}),a("q-stepper-navigation",[a("q-btn",{attrs:{color:"primary",label:"Continue",disable:0==t.selectedForSplit.length},on:{click:function(e){t.step=2,t.updateSubtotal()}}})],1)],1),a("q-step",{attrs:{name:2,title:"Details",icon:"save"}},[a("q-table",{attrs:{columns:t.columns,title:"Selected Items",data:t.selectedForSplit,"row-key":"sl_no","wrap-cells":"","rows-per-page-options":[0]},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),a("q-td",[t._v("\n                "+t._s(e.row.name)+"\n              ")]),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.qty)+"\n                "),a("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(a){return!0===t.qtyEditValidation(a,t.selectedForSplit[e.rowIndex].qty)}},on:{hide:function(a){t.updateRow(e.rowIndex),e.row.qty=parseInt(e.row.qty)}},model:{value:e.row.qty,callback:function(a){t.$set(e.row,"qty",a)},expression:"props.row.qty"}},[a("q-input",{ref:"qty_edit",attrs:{rules:[function(a){return t.qtyEditValidation(a,e.row.qty)}],dense:"",autofocus:""},on:{input:function(e){return t.$refs.qty_edit.resetValidation()}},model:{value:e.row.qty,callback:function(a){t.$set(e.row,"qty",a)},expression:"props.row.qty"}})],1)],1),a("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.expiry_date)+"\n              ")])],1)]}}])}),a("div",{staticClass:"row q-mt-md"},[a("div",{staticClass:"col"},[a("div",{staticClass:"text-subtitle2"},[t._v("Remarks")]),a("q-editor",{attrs:{rows:"3"},model:{value:t.remarks,callback:function(e){t.remarks=e},expression:"remarks"}})],1)]),a("q-stepper-navigation",[a("q-btn",{attrs:{color:"primary",label:"back"},on:{click:function(e){t.step=1}}}),a("q-btn",{staticClass:"q-ml-md",attrs:{color:"green",label:"Submit"},on:{click:function(e){return t.submitShipment()}}})],1)],1)],1)],1)],1)},O=[],L={props:["items"],data(){return{step:1,selectedForSplit:[],remarks:"",columns:[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Exp Date",sortable:!0}]}},methods:{qtyEditValidation(t,e){return t?!!Number.isInteger(Number(t))||"Qty must be an integer":"Required"},submitShipment(){this.$axios.post("sale_orders/ship/"+this.$route.params.id,{mode:"split",items:this.selectedForSplit}).then((t=>{})).error((t=>{t.response.status}))}}},A=L,E=Object(u["a"])(A,I,O,!1,null,null,null),N=E.exports;Q()(E,"components",{QCard:p["a"],QBar:m["a"],QSpace:h["a"],QBtn:_["a"],QTooltip:g["a"],QCardSection:b["a"],QStepper:v["a"],QStep:q["a"],QTable:f["a"],QTd:x["a"],QStepperNavigation:C["a"],QTr:k["a"],QPopupEdit:F["a"],QInput:S["a"],QEditor:D["a"]}),Q()(E,"directives",{ClosePopup:$["a"]});var B=a("b456"),j={name:"SaleOrdersView",components:{PageToolbar:i["a"],Breadcrumbs:o["a"],ReturnDialog:P,ShipmentDialog:N,SettlementDialog:B["a"]},data(){return{serial_no:"",customer:{name:null,non_billable_account:!1},representative:{name:null},created_by:{name:null},created_at:null,invoiced_at:null,status:null,remarks:"",warehouse:{name:null},pricelist:{name:null},source:null,rate_includes_gst:null,flood_cess_included:null,items:[],expirableItems:[],subtotal:null,discount:null,freight:null,round:null,total:null,search:null,table_loading:!1,payment_status:null,paid_amount:null,cod:0,otc:0,billingAddress:null,shippingAddress:null,cod_charge:null,remarkDialog:!1,approveRemark:"",shipment:null,invoiced_by:{name:null},order_no:null,po_number:null,order_date:null,settlementDialog:!1,amount:0,reference_id:"",payment_via:null,settlement_remarks:"",saleReturnDialog:!1,shipmentSelectionDialog:!1,selectedForShipment:[],return_count:null,quotation:null,dentodeal_data:"",approveLoading:!1}},mounted(){this.getDataFromApi()},computed:{totalWeight(){return this.$_.sumBy(this.items,(t=>parseFloat(t.product.weight*t.qty)))},balance_amount(){return this.total-this.paid_amount},toolbarButtons(){const t=[];return t.push({label:"Packaging",id:"packaging",type:"a",link:"/packaging/"+this.$route.params.id,flat:!0,color:"grey-9",icon:"archive"}),t.push({label:"Download PDF",id:"download",type:"button",flat:!0,color:"grey-7",icon:"get_app"}),"Cancelled"!==this.status&&(this.$store.getters.hasPermissionTo("revert_sale_order")&&"Draft"!==this.status&&t.push({label:"Revert",id:"revert",type:"button",color:"grey-7",icon:"undo"}),this.$store.getters.hasPermissionTo("create_sale_return")&&"Complete"===this.status&&t.push({label:"Create Sale Return",id:"salereturn",type:"button",color:"orange-7",icon:"undo"}),this.$store.getters.hasPermissionTo("ship_sale_order")&&"Invoiced"===this.status&&this.otc&&t.push({label:"Complete",id:"complete",type:"button",color:"green-7",icon:"check"}),this.$store.getters.hasPermissionTo("reject_sale_order")&&"Pending Approval"===this.status&&t.push({label:"Reject",id:"reject",type:"button",color:"red-8",icon:"close"}),this.$store.getters.hasPermissionTo("approve_sale_order")&&"Pending Approval"===this.status&&t.push({label:"Approve",id:"approve",type:"button",color:"green-8",icon:"check"}),!this.$store.getters.hasPermissionTo("request_approval_sale_order")||"Invoice Pending"!==this.status&&"Rejected"!==this.status||t.push({label:"Request for Approval",id:"requestapproval",type:"button",color:"orange-8",icon:"pan_tool"}),!this.$store.getters.hasPermissionTo("invoice_sale_order")||"Invoice Pending"!==this.status&&"Approved"!==this.status||t.push({label:"Invoice",id:"invoice",type:"button",color:"blue-7",icon:"receipt"}),!this.$store.getters.hasPermissionTo("send_to_accounts_sale_order")||"Draft"!==this.status&&"Confirmed"!==this.status||this.customer.non_billable_account||t.push({label:"Send to accounts",id:"sendtoaccounts",type:"button",color:"blue-10",icon:"forward"}),"Draft"!==this.status||"Dentodeal"!==this.source||this.customer.non_billable_account||t.push({label:"Send for confirmation",id:"sendforconfirmation",type:"button",color:"blue-10",icon:"forward"}),this.$store.getters.hasPermissionTo("confirm_sale_order")&&"Pending Confirmation"===this.status&&t.push({label:"Confirm",id:"confirm",type:"button",color:"green-10",icon:"check"}),"Draft"===this.status&&t.push({label:"Edit",id:"edit",type:"a",link:"/sale_orders/edit/"+this.$route.params.id,color:"teal",icon:"edit"}),this.shipment&&"Complete"===this.shipment.status||t.push({label:"Cancel",id:"cancel",type:"button",color:"red",icon:"close"})),t.push({label:"Duplicate",id:"duplicate",type:"a",link:"/sale_orders/create?duplicate="+this.$route.params.id,color:"grey",icon:"file_copy"}),t},columns(){const t=[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"weight",field:"weight",label:"Weight",sortable:!0},{name:"gst",field:"gst",label:"GST",sortable:!0},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"rate",field:"rate",label:"Rate",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Exp Date",sortable:!0},{name:"is_free",field:"is_free",label:"Free ?",sortable:!0}];return this.rate_includes_gst||t.push({name:"taxable",field:"taxable",label:"Taxable",sortable:!0},{name:"tax_amount",field:"tax_amount",label:"Tax Amt",sortable:!0}),t.push({name:"total",field:"total",label:"Total",sortable:!0}),t},breadcrumbs(){const t=[{label:"Dashboard",link:"/"},{label:"Sale Orders",link:"/sale_orders"},{label:this.serial_no}];return t}},methods:{getDataFromApi(){this.$q.loading.show(),this.$axios.get("sale_orders/"+this.$route.params.id).then((t=>{this.serial_no=t.data.serial_no,this.customer=t.data.customer,this.representative=t.data.representative,this.created_by=t.data.created_by,this.created_at=t.data.created_at,this.invoiced_at=t.data.invoiced_at,this.invoiced_by=t.data.invoiced_by,this.status=t.data.status,this.remarks=t.data.remarks,this.dentodeal_data=t.data.dentodeal_data,this.warehouse=t.data.warehouse,this.pricelist=t.data.pricelist,this.source=t.data.source,this.rate_includes_gst=t.data.rate_includes_gst,this.flood_cess_included=t.data.flood_cess_included,this.items=t.data.items,this.items.forEach(((t,e)=>{this.items[e].name=t.product.name})),this.subtotal=t.data.subtotal,this.discount=t.data.discount,this.freight=t.data.freight,this.round=t.data.round,this.total=t.data.total,this.otc=t.data.otc,this.cod=t.data.cod,this.paid_amount=t.data.paid_amount,this.cod_charge=t.data.cod_charge,this.payment_status=t.data.payment_status,this.shipment=t.data.shipment,this.billingAddress=t.data.billing_address,this.shippingAddress=t.data.shipping_address,this.order_no=t.data.order_no,this.po_number=t.data.po_number,this.order_date=t.data.order_date,this.return_count=t.data.return_count,this.quotation=t.data.quotation})).finally((()=>{this.$store.commit("setPageTitle",this.serial_no),this.$q.loading.hide()}))},getPaymentStatusColor(){return"Settled"===this.payment_status?"green-10":"Partially Settled"===this.payment_status?"orange-10":"Unsettled"===this.payment_status?"red-10":void 0},sendtoaccounts(){this.$q.dialog({cancel:!0,title:"Caution",message:"Do you want to continue ?"}).onOk((()=>{this.$axios.get("sale_orders/send_to_accounts/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is sent for invoice generation"}),this.$router.back())}))}))},invoice(){null===this.amount||void 0===this.amount||""===this.amount?this.$q.notify({message:"Amount should not be empty",type:"negative"}):null===this.payment_via&&parseFloat(this.amount)>0?this.$q.notify({message:"Payment Via is not specified",type:"negative"}):this.$axios.post("sale_orders/invoice/"+this.$route.params.id,{payment_via:this.payment_via,amount:this.amount,reference_id:this.reference_id,remarks:this.settlement_remarks}).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is invoiced succesfully"}),this.$router.back())}))},requestapproval(){this.$axios.get("sale_orders/request_approval/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is sent for approval"}),this.$router.back())}))},approve(){this.approveRemark="",this.remarkDialog=!0},submitApproval(){this.approveLoading=!0,this.$axios.post("sale_orders/approve/"+this.$route.params.id,{remarks:this.approveRemark}).then((t=>{"success"===t.data.message&&(this.remarkDialog=!1,this.$q.notify({type:"positive",message:"Sale Order is approved succesfully"}),this.$router.back())}))},reject(){this.$axios.get("sale_orders/reject/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is rejected succesfully"}),this.$router.back())}))},complete(){this.$q.dialog({cancel:!0,title:"Caution",message:"Do you want to continue ?"}).onOk((()=>{this.$axios.get("sale_orders/complete/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is set as complete"}),this.$router.back())}))}))},revert(){this.$q.dialog({cancel:!0,title:"Caution",message:"All transactions (settlements and refunds) & sale returns will be deleted !!!. Proceed ?"}).onOk((()=>{this.$axios.get("sale_orders/revert/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is reverted succesfully"}),this.$router.back())}))}))},cancel(){this.$q.dialog({cancel:!0,title:"Caution",message:"Do you want to continue ?"}).onOk((()=>{this.$axios.get("sale_orders/cancel/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"negative",message:"Sale Order is cancelled"}),this.$router.back())}))}))},sendforconfirmation(){this.$axios.get("sale_orders/request_confirmation/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is sent for confirmation"}),this.$router.back())}))},confirm(){this.$axios.get("sale_orders/confirm/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Sale Order is confirmed"}),this.$router.back())}))},getLocaleString(t){if(t){const e=new Date(t);return e.toLocaleString()}return""},download(){this.$q.loading.show(),this.$axios({url:"sale_orders/download/"+this.$route.params.id,method:"GET",responseType:"blob"}).then((t=>{const e=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=e,a.setAttribute("download",this.serial_no.replace(/\//g,"")+".pdf"),document.body.appendChild(a),a.click()})).finally((()=>{this.$q.loading.hide()}))}}},V=j,G=a("9989"),M=a("65c6"),W=a("2bb1"),Y=a("b047"),U=a("0016"),z=a("24e8"),H=a("4b7e"),J=Object(u["a"])(V,s,r,!1,null,null,null);e["default"]=J.exports;Q()(J,"components",{QPage:G["a"],QToolbar:M["a"],QSpace:h["a"],QBtn:_["a"],QBadge:w["a"],QMarkupTable:W["a"],QCard:p["a"],QCardSection:b["a"],QChip:Y["a"],QTable:f["a"],QTr:k["a"],QTd:x["a"],QInput:S["a"],QIcon:U["a"],QDialog:z["a"],QEditor:D["a"],QCardActions:H["a"]})}}]);