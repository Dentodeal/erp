(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{4309:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("page-toolbar",{attrs:{buttons:e.toolbarButtons},on:{save:function(t){return e.saveFn()},activate:function(t){return e.activateFn()}}}),a("breadcrumbs",{attrs:{breadcrumbs:e.breadcrumbs}}),a("div",{class:e.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[a("q-card",[a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-md-6 col-12 q-mt-md"},[a("q-select",{ref:"supplier",attrs:{outlined:"",square:"",dense:"",label:"Supplier","use-input":"","fill-input":"",rules:[function(e){return!!e||"Required"}],"hide-selected":"",options:e.supplierOptions,"option-value":"id","option-label":"name"},on:{filter:e.supplierFilterFn},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                                    No results\n                                    ")])],1)]},proxy:!0}]),model:{value:e.supplier,callback:function(t){e.supplier=t},expression:"supplier"}})],1),a("div",{staticClass:"col-md-6 col-12 q-mt-md"},[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col"},[a("q-input",{ref:"delivery_date",attrs:{dense:"",filled:"",readonly:"",label:"Delivery date",hint:"Click on calender icon to enter date",rules:[function(e){return!!e||"Required"}]},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{model:{value:e.delivery_date,callback:function(t){e.delivery_date=t},expression:"delivery_date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.delivery_date,callback:function(t){e.delivery_date=t},expression:"delivery_date"}})],1)])])]),a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-md-6 col-12 q-mt-md"},[a("q-select",{ref:"warehouse",attrs:{dense:"",label:"Warehouse","emit-value":"","map-options":"","option-value":"id","option-label":"name",outlined:"",square:"",rules:[function(e){return!!e||"Required"}],options:e.warehouses},model:{value:e.warehouse_id,callback:function(t){e.warehouse_id=t},expression:"warehouse_id"}})],1),a("div",{staticClass:"col-md-6 col-12 q-mt-md"},[a("q-input",{attrs:{readonly:"",outlined:"",square:"",dense:"",label:"Created By",value:e.$store.getters.user.name}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-table",{attrs:{columns:e.columns,title:"Items",data:e.items,"row-key":"product_id","wrap-cells":"",loading:e.table_loading,"rows-per-page-options":[0],filter:e.search},scopedSlots:e._u([{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{staticClass:"text-right"},[e._v(e._s(t.rowIndex+1))]),a("q-td",[e._v("\n                                        "+e._s(t.row.product.name)+"\n                                        "),a("q-btn",{attrs:{icon:"content_copy",flat:"",round:""},on:{click:function(a){return e.$store.dispatch("copyToClipboard",t.row.product.name)}}},[a("q-tooltip",[e._v("\n                                            Copy Name\n                                          ")])],1),a("q-btn",{attrs:{icon:"file_copy",flat:"",round:""},on:{click:function(a){return e.duplicateRow(t.row)}}},[a("q-tooltip",[e._v("\n                                            Duplicate Row\n                                          ")])],1)],1),a("q-td",{staticClass:"text-right"},[e._v("\n                                        "+e._s(t.row.expiry_date)+"\n                                        "),t.row.expirable?a("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(a){return!0===e.expiryEditValidation(a,t.row.expirable)}},model:{value:t.row.expiry_date,callback:function(a){e.$set(t.row,"expiry_date",a)},expression:"props.row.expiry_date"}},[a("q-input",{ref:"expiry_date_edit",attrs:{label:"Expiry Date",tabindex:"5",rules:[function(a){return e.expiryEditValidation(a,t.row.expirable)}],mask:"####-##-##",hint:"Format: yyyy/mm/dd"},on:{input:function(t){return e.$refs.expiry_date_edit.resetValidation()}},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",tabindex:"5"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:t.row.expiry_date,callback:function(a){e.$set(t.row,"expiry_date",a)},expression:"props.row.expiry_date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}],null,!0),model:{value:t.row.expiry_date,callback:function(a){e.$set(t.row,"expiry_date",a)},expression:"props.row.expiry_date"}})],1):e._e()],1),a("q-td",{staticClass:"text-right"},[e._v("\n                                        "+e._s(t.row.qty)+"\n                                        "),a("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(t){return!0===e.qtyValidation(t)}},on:{hide:function(a){e.updateRow(t.rowIndex),t.row.qty=parseInt(t.row.qty)},show:function(t){return e.$refs.qty_edit.select()}},model:{value:t.row.qty,callback:function(a){e.$set(t.row,"qty",a)},expression:"props.row.qty"}},[a("q-input",{ref:"qty_edit",attrs:{rules:[e.qtyValidation],dense:"",autofocus:""},on:{input:function(t){return e.$refs.qty_edit.resetValidation()}},model:{value:t.row.qty,callback:function(a){e.$set(t.row,"qty",a)},expression:"props.row.qty"}})],1)],1),a("q-td",{staticClass:"text-right"},[a("q-btn",{attrs:{round:"",icon:"delete",flat:"",color:"black"},on:{click:function(a){return e.deleteFn(t.rowIndex)}}})],1)],1)]}},{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]},proxy:!0}])})],1)]),a("div",{staticClass:"row q-col-gutter-xs q-mt-md"},[a("div",{staticClass:"col-4"},[a("q-select",{ref:"product",attrs:{clearable:"",tabindex:"1",outlined:"",square:"",dense:"",label:"Product",rules:[function(e){return!!e||"Required"}],"lazy-rules":"ondemand",options:e.productOptions,"option-value":"id","option-label":"name","use-input":"","fill-input":"","hide-selected":"",loading:e.prodLoading},on:{filter:e.productFilter},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                                    No results\n                                    ")])],1)]},proxy:!0}]),model:{value:e.product,callback:function(t){e.product=t},expression:"product"}})],1),a("div",{staticClass:"col"},[a("q-input",{ref:"expiry_date",attrs:{label:"Expiry Date",tabindex:"2",square:"",outlined:"",dense:"",disable:!this.expirable,rules:[e.expiryValidation],mask:"####-##-##","lazy-rules":"ondemand",hint:"Format: yyyy-mm-dd"},on:{input:function(t){return e.$refs.expiry_date.resetValidation()}},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event",tabindex:"5"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:e.expiry_date,callback:function(t){e.expiry_date=t},expression:"expiry_date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.expiry_date,callback:function(t){e.expiry_date=t},expression:"expiry_date"}})],1),a("div",{staticClass:"col"},[a("q-input",{ref:"qty",staticClass:"input-right",attrs:{tabindex:"3",outlined:"",square:"",dense:"",label:"Qty",rules:[e.qtyValidation],"lazy-rules":"ondemand"},on:{focus:function(e){return e.target.select()},blur:function(){e.qty=e.qty?parseInt(e.qty).toString():null}},model:{value:e.qty,callback:function(t){e.qty=t},expression:"qty"}})],1),a("div",{},[a("q-btn",{attrs:{icon:"add",tabindex:"4",round:"",flat:"",color:"teal"},on:{click:function(t){return e.addRow()}}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("div",{staticClass:"text-subtitle1 q-mt-md"},[e._v("Remarks")]),a("q-editor",{attrs:{"min-height":"5rem"},model:{value:e.remarks,callback:function(t){e.remarks=t},expression:"remarks"}})],1)])])],1)],1),a("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:e.toolbarButtons},on:{save:function(t){return e.saveFn()},activate:function(t){return e.activateFn()}}})],1)},i=[],r=(a("a434"),a("e6cf"),a("a79d"),a("ddb0"),a("a89c")),o=a("b6c6"),n={name:"PurchasesCreate",components:{PageToolbar:r["a"],Breadcrumbs:o["a"]},data(){return{supplier:null,supplierOptions:[],warehouses:[],warehouse_id:null,items:[],status:"Draft",delivery_date:null,productOptions:[],gstOptions:[],product:null,qty:null,expiry_date:null,columns:[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"expiry_date",field:"expiry_date",label:"Exp.Date",sortable:!0},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"actions",field:"actions",label:"",sortable:!1}],table_loading:!1,search:null,expirable:null,prodLoading:!1,errorQty:!1,errorMessageQty:"",errorRate:!1,errorMessageRate:"",remarks:""}},computed:{toolbarButtons(){const e=[];return(this.$store.getters.hasPermissionTo("create_purchase")||this.$store.getters.hasPermissionTo("update_purchase"))&&(e.push({label:"Activate",id:"activate",type:"button",color:"green",icon:"check"}),e.push({label:"Save as Draft",id:"save",type:"button",color:"teal",icon:"save"})),e},breadcrumbs(){const e=[{label:"Dashboard",link:"/"},{label:"Goods Receive Notes",link:"/purchases"},{label:this.$route.params.id?this.bill_number:"Create",link:"/goods_receive_notes/view/"+this.$route.params.id}];return this.$route.params.id&&e.push({label:"Edit",link:""}),e}},mounted(){this.$store.getters.hasPermissionTo("create_purchase")?(this.$q.loading.show(),Promise.all([this.$axios.get("warehouses").then((e=>{this.warehouses=e.data.model,1===this.warehouses.length&&(this.warehouse_id=this.warehouses[0].id)}))]).finally((()=>{this.$q.loading.hide()})),this.$route.params.id?(this.$q.loading.show(),this.$axios.get("goods_receive_notes/"+this.$route.params.id).then((e=>{this.supplier=e.data.supplier,this.delivery_date=e.data.delivery_date,this.warehouse_id=e.data.warehouse_id,this.remarks=e.data.remarks?e.data.remarks:"",this.items=e.data.items})).finally((()=>{this.$store.commit("setPageTitle","Edit Goods Receivable Note: "+this.bill_number),this.$q.loading.hide()}))):this.$store.commit("setPageTitle","Create Goods Receivable Note")):this.$router.push({name:"Error403"})},methods:{supplierFilterFn(e,t,a){t((()=>{e&&this.$axios.get("suppliers_search?&search="+encodeURIComponent(e)).then((e=>{this.supplierOptions=e.data}))}))},productFilter(e,t,a){t((()=>{e&&(this.prodLoading=!0,this.$axios.get("products/search?keyword="+encodeURIComponent(e)).then((e=>{this.productOptions=e.data})).finally((()=>{this.prodLoading=!1})))}))},addRow(){this.$refs.product.validate()&this.$refs.qty.validate()&this.$refs.expiry_date.validate()&&(this.items.push({sl_no:this.items.length+1,name:this.product.name,product_id:this.product.id,product:this.product,expiry_date:this.expiry_date,expirable:this.expirable,qty:this.qty}),this.product=null,this.qty=null,this.expiry_date=null,this.expirable=null,this.$nextTick((()=>{this.$refs.product.focus()})))},deleteFn(e){this.$q.dialog({title:"Confirm",message:"Would you like to delete this record?",cancel:!0,persistent:!0}).onOk((()=>{this.items.splice(e,1)})).onCancel((()=>{}))},qtyValidation(e){return e?Number.isInteger(Number(e))?!(Number(e)<1)||"Invalid":"Must be an Integer":"Required"},activateFn(){this.saveFn("Active")},saveFn(e="Draft"){if(this.$refs.supplier.validate()&this.$refs.delivery_date.validate()&this.$refs.warehouse.validate()&this.validateItemsCount()){const t={_method:this.$route.params.id?"PUT":"POST",status:e,supplier_id:this.supplier.id,delivery_date:this.delivery_date,warehouse_id:this.warehouse_id,items:this.$_.map(this.items,this.$_.partialRight(this.$_.pick,["product_id","qty","expirable","expiry_date"])),remarks:this.remarks};let a="goods_receive_notes";this.$route.params.id&&(a="goods_receive_notes/"+this.$route.params.id),this.$q.loading.show(),this.$axios.post(a,t).then((e=>{"success"===e.data.message&&(this.$q.loading.hide(),this.$q.notify({type:"positive",message:"Saved Succesfully."}),this.$router.back())})).catch((e=>{this.$q.loading.hide(),422===e.response.status&&this.$q.notify({type:"negative",message:e.response.data.message})})).finally((()=>{this.$q.loading.hide()}))}else this.$q.notify({type:"negative",message:"Invalid data given !!!"})},validateItemsCount(){return this.items.length>0||(this.$q.notify({type:"negative",message:"There should be atleast one item"}),!1)},expiryValidation(e){if(this.expirable){if(!e)return"Required";if(!/^-?[\d]+-[0-1]\d-[0-3]\d$/.test(e))return"Invalid Date"}return!0},expiryEditValidation(e,t){return!(t&&e&&!/^-?[\d]+-[0-1]\d-[0-3]\d$/.test(e))||"Invalid Date"},duplicateRow(e){this.items.push(this.$_.cloneDeep(e))}},watch:{product(e,t){e&&this.$axios.get("products/"+e.id).then((e=>{this.gst=e.data.gst,this.expirable=e.data.expirable,this.expiry_date=null}))}}},l=n,d=a("2877"),u=a("9989"),c=a("f09f"),p=a("a370"),h=a("ddd8"),m=a("66e5"),y=a("4074"),b=a("27f9"),f=a("0016"),v=a("7cbe"),q=a("52ee"),_=a("9c40"),x=a("eaac"),w=a("bd08"),g=a("db86"),$=a("05c0"),k=a("42a1"),C=a("d66b"),Q=a("7f67"),R=a("eebe"),D=a.n(R),I=Object(d["a"])(l,s,i,!1,null,null,null);t["default"]=I.exports;D()(I,"components",{QPage:u["a"],QCard:c["a"],QCardSection:p["a"],QSelect:h["a"],QItem:m["a"],QItemSection:y["a"],QInput:b["a"],QIcon:f["a"],QPopupProxy:v["a"],QDate:q["a"],QBtn:_["a"],QTable:x["a"],QTr:w["a"],QTd:g["a"],QTooltip:$["a"],QPopupEdit:k["a"],QEditor:C["a"]}),D()(I,"directives",{ClosePopup:Q["a"]})}}]);