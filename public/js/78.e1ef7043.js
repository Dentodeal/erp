(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[78],{8467:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("page-toolbar",{attrs:{buttons:t.toolbarButtons},on:{revert:t.revertFn,sendToAdmin:t.sendToAdmin,approve:t.approveFn,activate:t.activateFn,purchasereturn:function(e){t.purchaseReturnDialog=!0}}}),s("breadcrumbs",{attrs:{breadcrumbs:t.breadcrumbs}}),t.return_count>0?s("q-toolbar",{staticClass:"q-px-lg"},[s("q-space"),s("q-btn",{attrs:{depressed:"",color:"cyan-7",label:"purchase returns",to:"/purchases/returns/"+t.$route.params.id}},[s("q-badge",{staticClass:"text-black q-ml-sm",attrs:{color:"white"}},[t._v(t._s(t.return_count))])],1)],1):t._e(),s("div",{class:t.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[s("q-card",[s("div",{staticClass:"row q-col-gutter-md q-pa-md "},[s("div",{staticClass:"col"},[s("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[s("tbody",[s("tr",[s("td",[t._v("Bill Number")]),s("td",[t._v(t._s(t.bill_number))])]),s("tr",[s("td",[t._v("Supplier")]),s("td",[s("router-link",{attrs:{to:"/suppliers/view/"+t.supplier.id}},[t._v(t._s(t.supplier.name))])],1)]),s("tr",[s("td",[t._v("Warehouse")]),s("td",[t._v(t._s(t.warehouse.name))])]),s("tr",[s("td",[t._v("Created By")]),s("td",[t._v(t._s(t.created_by.name))])])])])],1),s("div",{staticClass:"col"},[s("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[s("tbody",[s("tr",[s("td",[t._v("Status")]),s("td",[t._v(t._s(t.status))])]),s("tr",[s("td",[t._v("Bill Date")]),s("td",[t._v(t._s(t.bill_date))])]),s("tr",[s("td",[t._v("Delivery Date")]),s("td",[t._v(t._s(t.delivery_date))])]),t.grn?s("tr",[s("td",[t._v("GRN No")]),s("td",[s("router-link",{attrs:{to:"/goods_receive_notes/view/"+t.grn.id}},[t._v(t._s(t.grn.serial_no))])],1)]):t._e()])])],1)]),s("div",{staticClass:"row q-col-gutter-md"},[s("div",{staticClass:"col"},[s("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[s("tbody",[s("tr",[s("td",{staticClass:"text-left"},[t._v("Row discount mode:")]),s("td",{staticClass:"text-left"},[t._v(" "+t._s(t.row_discount_mode))])])])])],1),s("div",{staticClass:"col"},[s("q-markup-table",{attrs:{"wrap-cells":"",separator:"cell"}},[s("tbody",[s("tr",[s("td",{staticClass:"text-left"},[t._v("Freight Split Method:")]),s("td",{staticClass:"text-left"},[t._v(" "+t._s(t.freight_split_method))])])])])],1)]),s("div",{staticClass:"row q-col-gutter-md q-pa-md "},[s("div",{staticClass:"col"},[s("q-table",{staticClass:"my-sticky-header-table",attrs:{columns:t.columns,title:"Items",data:t.items,"row-key":"index","wrap-cells":"",loading:t.table_loading,"rows-per-page-options":[0],filter:t.search},scopedSlots:t._u([{key:"bottom-row",fn:function(){return[s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"9"}}),s("q-td",{staticClass:"text-right"},[t._v("Total")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.tax_row_total))]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.taxable_total))])],1),s("q-tr",[s("q-td",{attrs:{colspan:"100%"}})],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Discount Taxable")]),s("q-td",{staticClass:"text-right"},[t._v(" - "+t._s(t.taxable_discount))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Items tax")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.tax_total))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Bill Freight Tax")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.bill_freight_gst))])],1),s("q-tr",{staticClass:"bg-blue-grey-3"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Subtotal")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.subtotal))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Discount Subtotal")]),s("q-td",{staticClass:"text-right"},[t._v(" - "+t._s(t.discount_subtotal))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Bill Freight")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.bill_freight))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Round")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.round))])],1),s("q-tr",{staticClass:"bg-blue-grey-3"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Bill Total")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.bill_total))])],1),s("q-tr",{staticClass:"bg-blue-grey-1"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("External Freight")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.external_freight))])],1),s("q-tr",{staticClass:"bg-blue-grey-3"},[s("q-td",{attrs:{colspan:"10"}}),s("q-td",{staticClass:"text-right"},[t._v("Grand Total")]),s("q-td",{staticClass:"text-right"},[t._v(t._s(t.grand_total))])],1)]},proxy:!0},{key:"header",fn:function(e){return[s("q-tr",{attrs:{props:e}},[s("q-th",{attrs:{"auto-width":""}}),t._l(e.cols,(function(a){return s("q-th",{key:a.name,attrs:{props:e}},[t._v("\n                  "+t._s(a.label)+"\n                ")])}))],2)]}},{key:"body",fn:function(e){return[s("q-tr",{attrs:{props:e}},[s("q-td",{attrs:{"auto-width":""}},[s("q-btn",{attrs:{size:"md",color:"grey-7",round:"",dense:"",flat:"",icon:e.expand?"arrow_drop_down":"arrow_right"},on:{click:function(t){e.expand=!e.expand}}})],1),s("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),s("q-td",[s("router-link",{attrs:{to:"/products/view/"+e.row.product.id}},[t._v(" "+t._s(e.row.product.name))]),s("q-btn",{attrs:{icon:"content_copy",flat:"",round:""},on:{click:function(s){return t.$store.dispatch("copyToClipboard",e.row.product.name)}}})],1),s("q-td",{staticClass:"text-left"},[t._v("\n                  "+t._s(e.row.local?"Yes":"No")+"\n                ")]),s("q-td",{staticClass:"text-right"},[e.row.gst?s("div",[t._v("\n                    "+t._s(e.row.gst)+"%\n                  ")]):t._e()]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.qty)+"\n                ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.is_free?"Yes":"No")+"\n                ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.rate)+"\n                ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.cost)+"\n                ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.discount)),"percentage"==t.row_discount_mode?s("span",[t._v("%")]):t._e()]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.tax_amount)+"\n                ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                  "+t._s(e.row.taxable)+"\n                ")])],1),s("q-tr",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"props.expand"}],staticClass:"bg-grey-4",attrs:{props:e}},[s("q-td"),s("q-td"),s("q-td",{staticClass:"text-left"},[t._v("\n                  Weight: "+t._s(e.row.weight)+"\n                ")]),s("q-td",{staticClass:"text-left"},[t._v("\n                  MRP: "+t._s(e.row.mrp)+"\n                ")]),s("q-td",{staticClass:"text-left"},[t._v("\n                  HSN: "+t._s(e.row.hsn)+"\n                ")]),s("q-td",{staticClass:"text-left"},[t._v(" Expiry: "+t._s(e.row.expiry_date))]),s("q-td",{attrs:{colspan:"7"}})],1)]}},{key:"top-right",fn:function(e){return[s("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),s("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:e.toggleFullscreen}})]}}])})],1)]),s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"text-h6"},[t._v("Remarks")]),s("div",{domProps:{innerHTML:t._s(t.remarks)}})])])])],1),s("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:t.toolbarButtons},on:{revert:t.revertFn,sendToAdmin:t.sendToAdmin,approve:t.approveFn,activate:t.activateFn,purchasereturn:function(e){t.purchaseReturnDialog=!0}}}),s("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.purchaseReturnDialog,callback:function(e){t.purchaseReturnDialog=e},expression:"purchaseReturnDialog"}},[s("return-dialog",{attrs:{items:t.items}})],1)],1)},r=[],i=(s("c975"),s("e6cf"),s("a79d"),s("ddb0"),s("a89c")),l=s("b6c6"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"bg-primary"},[s("q-bar",[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[s("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"text-h6 text-white"},[t._v("Create Purchase Return")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("q-stepper",{ref:"stepper",attrs:{color:"primary",animated:""},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[s("q-step",{attrs:{name:1,title:"Selection",icon:"check"}},[s("q-table",{attrs:{columns:[{name:"ind",field:"ind",label:"#",align:"right"},{name:"product",field:"product",label:"Product",align:"left",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Expiry Date"}],data:t.items,title:"Please select products to return",selection:"multiple",selected:t.selectedForReturn},on:{"update:selected":function(e){t.selectedForReturn=e}},scopedSlots:t._u([{key:"body-selection",fn:function(e){return[s("q-checkbox",{attrs:{disable:e.row.returned_qty===e.row.qty},model:{value:e.selected,callback:function(s){t.$set(e,"selected",s)},expression:"scope.selected"}})]}},{key:"body-cell-ind",fn:function(e){return[s("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.rowIndex+1)+"\n            ")])]}},{key:"body-cell-product",fn:function(e){return[s("q-td",{attrs:{props:e}},[t._v("\n              "+t._s(e.row.product.name)+"\n              "),e.row.returned_qty>0&&e.row.returned_qty!=e.row.qty?s("q-badge",{attrs:{align:"top",outline:"",color:"primary",label:"Partially Returned"}}):t._e(),e.row.returned_qty>0&&e.row.returned_qty==e.row.qty?s("q-badge",{attrs:{align:"top",outline:"",color:"red",label:"Returned"}}):t._e()],1)]}},{key:"header-selection",fn:function(){},proxy:!0}])}),s("q-stepper-navigation",[s("q-btn",{attrs:{color:"primary",label:"Continue",disable:0==t.selectedForReturn.length},on:{click:function(e){t.step=2}}})],1)],1),s("q-step",{attrs:{name:2,title:"Details",icon:"save"}},[s("q-table",{staticClass:"my-sticky-header-table",attrs:{columns:t.columns,title:"Selected Items",data:t.selectedForReturn,"row-key":"sl_no","wrap-cells":"","rows-per-page-options":[0]},scopedSlots:t._u([{key:"body",fn:function(e){return[s("q-tr",{attrs:{props:e}},[s("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),s("q-td",[t._v("\n                "+t._s(e.row.product.name)+"\n              ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.qty)+"\n                "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(s){return!0===t.qtyEditValidation(s,t.selectedForReturn[e.rowIndex].qty)}},on:{hide:function(s){t.updateRow(e.rowIndex),e.row.qty=parseInt(e.row.qty)}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}},[s("q-input",{ref:"qty_edit",attrs:{rules:[function(s){return t.qtyEditValidation(s,e.row.qty)}],dense:"",autofocus:""},on:{input:function(e){return t.$refs.qty_edit.resetValidation()}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}})],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                "+t._s(e.row.expiry_date)+"\n              ")])],1)]}}])}),s("div",{staticClass:"row q-mt-md"},[s("div",{staticClass:"col"},[s("div",{staticClass:"text-subtitle2"},[t._v("Remarks")]),s("q-editor",{attrs:{rows:"3"},model:{value:t.returnRemarks,callback:function(e){t.returnRemarks=e},expression:"returnRemarks"}})],1)]),s("q-stepper-navigation",[s("q-btn",{attrs:{color:"primary",label:"back"},on:{click:function(e){t.step=1}}}),s("q-btn",{staticClass:"q-ml-md",attrs:{color:"green",label:"Submit"},on:{click:function(e){return t.submitReturn()}}})],1)],1)],1)],1)],1)},n=[],d={props:["items","rateIncludesGst"],data(){return{step:1,selectedForReturn:[],errorQty:!1,errorMessageQty:"",returnRemarks:"",return_count:0,columns:[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:"name",label:"Product",sortable:!0,align:"left"},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"expiry_date",field:"expiry_date",label:"Exp Date",sortable:!0}]}},watch:{returnSubtotal(){this.updateTotal()},returnFreight(){this.updateTotal()}},methods:{qtyEditValidation(t,e){return t?!!Number.isInteger(Number(t))||"Qty must be an integer":"Required"},submitReturn(){this.$axios.post("purchase_returns",{purchase_id:this.$route.params.id,status:"Draft",items:this.selectedForReturn,remarks:this.returnRemarks}).then((t=>{"success"===t.data.message&&this.$router.push({path:"/purchase_returns/view/"+t.data.id})})).catch((t=>{this.$q.notify({type:"negative",message:t.response.data.message});let e="";Object.keys(t.response.data.errors).forEach((s=>{-1!==s.indexOf("items")&&(e+="<p>Line "+(parseInt(s.substr(s.indexOf(".")+1))+1)+":"+t.response.data.errors[s][0]+"</p><br>")})),this.$q.dialog({title:"Error in data submitted",message:e,html:!0})}))}}},c=d,u=s("2877"),p=s("f09f"),h=s("d847"),_=s("2c91"),b=s("9c40"),g=s("05c0"),m=s("a370"),q=s("f531"),f=s("87fe"),v=s("eaac"),x=s("8f8e"),y=s("db86"),w=s("58a81"),C=s("b19c"),k=s("bd08"),$=s("42a1"),F=s("27f9"),T=s("d66b"),Q=s("7f67"),R=s("eebe"),D=s.n(R),P=Object(u["a"])(c,o,n,!1,null,null,null),S=P.exports;D()(P,"components",{QCard:p["a"],QBar:h["a"],QSpace:_["a"],QBtn:b["a"],QTooltip:g["a"],QCardSection:m["a"],QStepper:q["a"],QStep:f["a"],QTable:v["a"],QCheckbox:x["a"],QTd:y["a"],QBadge:w["a"],QStepperNavigation:C["a"],QTr:k["a"],QPopupEdit:$["a"],QInput:F["a"],QEditor:T["a"]}),D()(P,"directives",{ClosePopup:Q["a"]});var A={name:"PurchasesView",components:{PageToolbar:i["a"],Breadcrumbs:l["a"],ReturnDialog:S},data(){return{bill_number:null,supplier:{name:null},created_by:{name:null},warehouse:{name:null},items:[],expirableItems:[],subtotal:0,bill_total:0,delivery_date:null,round:0,discount_subtotal:0,discount:0,bill_freight:0,bill_freight_includes_gst:!1,bill_freight_gst:null,external_freight:0,status:"draft",bill_date:null,row_discount_mode:"percentage",grand_total:0,table_loading:!1,search:null,expirable:null,remarks:"",taxable_total:null,tax_row_total:null,tax_total:null,taxable_discount:null,freight_split_method:null,discount_split_method:"",grn:null,purchaseReturnDialog:!1,return_count:0}},computed:{columns(){const t=[{name:"sl_no",field:"sl_no",label:"#",sortable:!0},{name:"name",field:t=>t.product.name,label:"Product",sortable:!0,align:"left"},{name:"local",field:"local",label:"Avoid Costing?",sortable:!0,align:"left"},{name:"gst",field:"gst",label:"GST",sortable:!0},{name:"qty",field:"qty",label:"Qty",sortable:!0},{name:"is_free",field:"is_free",label:"Free ?",sortable:!0},{name:"rate",field:"rate",label:"Rate",sortable:!0}];return this.$store.getters.hasPermissionTo("view_product_pricing")&&t.push({name:"cost",field:"cost",label:"Cost",sortable:!0}),t.push({name:"discount",field:"discount",label:"Discount",sortable:!0},{name:"tax_amount",field:"tax_amount",label:"Tax Amount",sortable:!0},{name:"taxable",field:"taxable",label:"Taxable",sortable:!0}),t},toolbarButtons(){const t=[];return this.$store.getters.hasPermissionTo("revert_purchase")&&"Pending Approval"===this.status&&t.push({label:"Revert",id:"revert",type:"button",color:"grey-7",icon:"undo"}),this.$store.getters.hasPermissionTo("activate_purchase")&&"Admin Approved"===this.status&&t.push({label:"Activate",id:"activate",type:"button",color:"green-10",icon:"check"}),this.$store.getters.hasPermissionTo("create_purchase_return")&&"Active"===this.status&&t.push({label:"Create Purchase Return",id:"purchasereturn",type:"button",color:"orange-7",icon:"undo"}),this.$store.getters.hasPermissionTo("approve_purchase")&&"Pending Approval"===this.status&&t.push({label:"Approve",id:"approve",type:"button",color:"green-10",icon:"check"}),this.$store.getters.hasPermissionTo("update_purchase")&&"Draft"===this.status&&(t.push({label:"Send To Admin",id:"sendToAdmin",type:"button",color:"blue-10",icon:"forward"}),t.push({label:"Edit",id:"edit",type:"a",link:"/purchases/edit/"+this.$route.params.id,color:"teal",icon:"edit"})),t},breadcrumbs(){const t=[{label:"Dashboard",link:"/"},{label:"Purchases",link:"/purchases"},{label:this.bill_number}];return t}},mounted(){this.$store.getters.hasPermissionTo("view_purchase")?(this.$q.loading.show(),Promise.all([this.getDataFromApi()]).finally((()=>{this.$q.loading.hide()}))):this.$router.push({name:"Error403"})},watch:{freight_split_method(t){null!==t&&this.calculateCosting()}},methods:{calculateCosting(){this.$q.loading.show();let t=0,e=0;parseFloat(this.discount_subtotal)>0&&(t=parseFloat(this.discount_subtotal)/parseFloat(this.subtotal)),parseFloat(this.taxable_discount)>0&&(e=parseFloat(this.taxable_discount)/parseFloat(this.taxable_total));const s=this.$_.groupBy(this.items,"product_id");let a=0;if(parseFloat(this.bill_freight)>0||parseFloat(this.external_freight)>0){const t=isNaN(this.bill_freight)?0:parseFloat(this.bill_freight),e=isNaN(this.external_freight)?0:parseFloat(this.external_freight);a=t+e}this.items.forEach(((r,i)=>{if(!r.is_free&&!r.local){let l=r.rate;if(s[r.product_id].length>1&&(l=this.$_.sumBy(s[r.product_id],(t=>parseFloat(t.taxable)))/this.$_.sumBy(s[r.product_id],"qty")),r.discount&&parseFloat(r.discount)>0&&("percentage"===this.row_discount_mode?l*=1-parseFloat(r.discount)/100:l-=parseFloat(r.discount)),t&&(l*=1-t),e&&(l*=1-e),parseFloat(this.bill_freight)>0||parseFloat(this.external_freight)>0){let t=0;if("weight"===this.freight_split_method){const e=this.$_.sumBy(this.items,(t=>parseFloat(t.weight)*parseInt(t.qty))),s=a/e;t=parseFloat(l)+parseFloat(s)*parseFloat(r.weight)}if("equal"===this.freight_split_method){const e=a/parseFloat(this.taxable_total);t=parseFloat(l)*(1+e)}this.items[i].cost=parseFloat(t).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})}else this.items[i].cost=parseFloat(l).toLocaleString("en",{minimumFractionDigits:2,maximumFractionDigits:2})}})),this.$q.loading.hide()},getDataFromApi(){this.$q.loading.show(),this.$axios.get("purchases/"+this.$route.params.id).then((t=>{this.bill_number=t.data.bill_number,this.status=t.data.status,this.supplier=t.data.supplier,this.bill_date=t.data.bill_date,this.delivery_date=t.data.delivery_date,this.created_by=t.data.created_by,this.warehouse=t.data.warehouse,this.row_discount_mode=t.data.row_discount_mode,this.bill_freight_includes_gst=t.data.bill_freight_includes_gst,this.bill_freight_gst=t.data.bill_freight_gst,this.subtotal=t.data.subtotal,this.discount_subtotal=t.data.discount_subtotal,this.bill_freight=t.data.bill_freight,this.round=t.data.round,this.bill_total=t.data.bill_total,this.external_freight=t.data.external_freight,this.grand_total=t.data.grand_total,this.remarks=t.data.remarks,this.items=t.data.items,this.taxable_total=t.data.taxable_total,this.tax_row_total=t.data.tax_row_total,this.tax_total=t.data.tax_total,this.tax_total=t.data.tax_total,this.taxable_discount=t.data.taxable_discount,this.freight_split_method=t.data.freight_split_method,this.grn=t.data.grn,this.return_count=t.data.return_count})).then((()=>{this.freight_split_method||(this.freight_split_method="weight"),this.$store.commit("setPageTitle","Purchase: "+this.bill_number),this.$q.loading.hide()}))},revertFn(){this.$q.dialog({message:"Do you want to continue",cancel:!0}).onOk((()=>{this.$axios.get("purchases/revert/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({message:"Purchase Reverted Successfully"}),this.$router.back())}))}))},sendToAdmin(){this.$q.dialog({message:"Do you want to continue",cancel:!0}).onOk((()=>{this.$q.loading.show(),this.$axios.get("purchases/send_admin/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({color:"blue-10",message:"Purchase Sent for Approval"}),this.$router.back())})).catch((t=>{if(422===t.response.status){this.$q.notify({type:"negative",message:t.response.data.message});let e="";Object.keys(t.response.data.errors).forEach((s=>{e+="<p>"+t.response.data.errors[s][0]+"</p>"})),this.$q.dialog({message:e,html:!0})}})).finally((()=>{this.$q.loading.hide()}))}))},approveFn(){this.$q.dialog({message:"Do you want to continue",cancel:!0}).onOk((()=>{this.$axios.post("purchases/approve/"+this.$route.params.id,{freight_split_method:this.freight_split_method}).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Purchase Approved Successfully"}),this.$router.back())})).catch((t=>{this.$q.notify({type:"negative",message:t.response.data.message});let e="";Object.keys(t.response.data.errors).forEach((s=>{-1!==s.indexOf("items")&&(e+="<p>Line "+(parseInt(s.substr(s.indexOf(".")+1))+1)+":"+t.response.data.errors[s][0]+"</p><br>")})),this.$q.dialog({title:"Error in data submitted",message:e,html:!0})}))}))},activateFn(){this.$q.dialog({message:"Do you want to continue",cancel:!0}).onOk((()=>{this.$axios.get("purchases/activate/"+this.$route.params.id).then((t=>{"success"===t.data.message&&(this.$q.notify({type:"positive",message:"Data Updated Successfully"}),this.$router.back())}))}))}}},B=A,E=s("9989"),I=s("65c6"),N=s("2bb1"),O=s("357e"),j=s("0016"),L=s("24e8"),M=Object(u["a"])(B,a,r,!1,null,null,null);e["default"]=M.exports;D()(M,"components",{QPage:E["a"],QToolbar:I["a"],QSpace:_["a"],QBtn:b["a"],QBadge:w["a"],QCard:p["a"],QMarkupTable:N["a"],QTable:v["a"],QTr:k["a"],QTd:y["a"],QTh:O["a"],QInput:F["a"],QIcon:j["a"],QDialog:L["a"]})}}]);