(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[39],{d2c3:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("page-toolbar",{attrs:{buttons:t.toolbarButtons},on:{converttocustomer:function(e){return t.convert()}}}),a("breadcrumbs",{attrs:{breadcrumbs:t.breadcrumbs}}),a("q-card",[a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-xs-12 col-md-6"},[a("q-markup-table",{attrs:{separator:"cell","wrap-cells":""}},[a("tbody",[a("tr",[a("td",[t._v("Status")]),a("td",[t._v(t._s(t.status))])]),a("tr",[a("td",[t._v("Name")]),a("td",[t._v(t._s(t.name))])]),a("tr",[a("td",[t._v("Type")]),a("td",[t._v(t._s(t.type))])]),a("tr",[a("td",[t._v("GST No.")]),a("td",[t._v(t._s(t.gst_number))])]),a("tr",[1==t.representatives.length?a("td",[t._v("\n                                  Representatives\n                              ")]):t._e(),a("td",[t._v("\n                                  "+t._s(t.getRepresentatives())+"\n                              ")])]),t._l(t.emails,(function(e,s){return a("tr",{key:"email-"+s},[a("td",[0==s?a("div",[t._v("Emails")]):t._e()]),a("td",[t._v(t._s(e.content))])])})),t.addresses.length>0?a("tr",[a("td",[t._v("Billing Address")]),a("td",[t._v(t._s(t.getBillingAddress()))])]):t._e(),t.addresses.length>0?t._l(t.addresses,(function(e,s){return a("tr",{key:"tag-"+s},["billing"!=e.tag_name?[a("td",[a("div",[t._v("Shipping Address"),t.default_shipping==e.id?a("span",[t._v(" (Default)")]):t._e()])]),a("td",[t._v(t._s(t.addressFormat(e)))])]:t._e()],2)})):t._e(),a("tr",[a("td",[t._v("Tags")]),a("td",[t._v(t._s(t.getTags()))])]),a("tr",[a("td",[t._v("Created At")]),a("td",[t._v(t._s(t.getLocaleString(this.created_at)))])]),a("tr",[a("td",[t._v("Updated At")]),a("td",[t._v(t._s(t.getLocaleString(this.updated_at)))])])],2)])],1),a("div",{staticClass:"col-xs-12 col-md-6"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-btn",{attrs:{label:"Add Remarks",color:"primary"},on:{click:function(e){t.remarkDialog=!0}}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Update Status",color:"secondary"},on:{click:function(e){t.statusDialog=!0}}})],1)]),t.linked.length>0?a("div",{staticClass:"text-subtitle2 q-mb-md"},[t._v("Relations")]):t._e(),t.linked.length>0?a("q-markup-table",{attrs:{separator:"cell","wrap-cells":""}},[a("thead",[a("th",{staticClass:"text-left"},[t._v("Customer Name")]),a("th",{staticClass:"text-left"},[t._v("Relation Type")]),a("th",{staticClass:"text-left"},[t._v("Specification")])]),a("tbody",t._l(t.linked,(function(e,s){return a("tr",{key:"linked"+s},[a("td",[a("router-link",{attrs:{to:"/customers/view/"+e.id}},[t._v(t._s(e.name))])],1),a("td",[t._v(t._s(e.pivot.relation_type))]),a("td",[t._v(t._s(e.pivot.specification))])])})),0)]):t._e(),a("div",{staticClass:"text-subtitle2 q-my-md"},[t._v("Remarks")]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"text",domProps:{innerHTML:t._s(t.remarks)}})])])],1)])])],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.remarkDialog,callback:function(e){t.remarkDialog=e},expression:"remarkDialog"}},[a("q-card",{staticStyle:{width:"550px"}},[a("q-card-section",[a("div",{staticClass:"text-subtitle1"},[t._v("Remark")])]),a("q-card-section",[a("q-editor",{attrs:{rows:"5"},model:{value:t.new_remark,callback:function(e){t.new_remark=e},expression:"new_remark"}})],1),a("q-card-actions",[a("q-btn",{attrs:{color:"primary",label:"Submit"},on:{click:t.submitRemark}}),a("q-btn",{attrs:{color:"primary",flat:"",label:"Cancel"},on:{click:function(e){t.new_remark="",t.remarkDialog=!1}}})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.statusDialog,callback:function(e){t.statusDialog=e},expression:"statusDialog"}},[a("q-card",{staticStyle:{width:"550px"}},[a("q-card-section",[a("div",{staticClass:"text-subtitle1"},[t._v("Update Status")])]),a("q-card-section",[a("q-option-group",{attrs:{options:t.statusOptions,type:"radio"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),a("q-card-actions",[a("q-btn",{attrs:{color:"primary",label:"Submit"},on:{click:t.submitStatus}}),a("q-btn",{attrs:{color:"primary",flat:"",label:"Cancel"},on:{click:function(e){t.statusDialog=!1}}})],1)],1)],1),a("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:t.toolbarButtons}})],1)},r=[],i=(a("e6cf"),a("a79d"),a("a89c")),l=a("b6c6"),n={name:"CustomersView",components:{PageToolbar:i["a"],Breadcrumbs:l["a"]},data(){return{name:null,status:null,type:null,gst_number:null,addresses:[],linked:[],representatives:[],tags:[],emails:[],default_shipping:null,non_billable_account:null,prevRoute:null,remarks:"",new_remark:"",remarkDialog:!1,statusDialog:!1,created_at:null,updated_at:null,statusOptions:[{label:"Draft",value:"Draft"},{label:"Attempting Contact",value:"Attempting Contact"},{label:"Working",value:"Working"},{label:"Qualified",value:"Qualified"},{label:"Disqualified",value:"Disqualified"},{label:"Reattempt Required",value:"Reattempt Required"}]}},beforeRouteEnter(t,e,a){a((t=>{t.prevRoute=e}))},mounted(){this.getDataFromApi()},computed:{toolbarButtons(){const t=[];return this.$store.getters.hasPermissionTo("update_lead")&&"Draft"===this.status&&(t.push({label:"Convert To Customer",id:"converttocustomer",type:"button",color:"blue-10",icon:"forward"}),t.push({label:"Edit",id:"edit",type:"a",link:"/leads/edit/"+this.$route.params.id,color:"teal",icon:"edit"})),t},breadcrumbs(){const t=[{label:"Dashboard",link:"/"},{label:"Leads",link:"/leads"},{label:this.name}];return t}},methods:{getBillingAddress(){let t=null;return this.addresses.forEach(((e,a)=>{"billing"===e.tag_name&&(t=a)})),null!=t?this.addressFormat(this.addresses[t]):""},addressFormat(t){let e="";return e+=t.line_1+", ",t.line_2&&(e+=t.line_2+", "),t.pin&&(e+=t.pin+", "),t.district&&(e+=t.district+", "),e+=t.state+", ",e+=t.country+", ",t.phones.forEach((t=>{e+="("+t.country_code+")"+t.content+", "})),e=e.substr(0,e.length-2),e},getRepresentatives(){let t="";return this.representatives.forEach(((e,a)=>{t+=e.name+", "})),t=t.substr(0,t.length-2),t},getTags(){let t="";return this.tags.forEach(((e,a)=>{t+=e.content+", "})),t.length>0&&(t=t.substr(0,t.length-2)),t},submitRemark(){this.new_remark.length>0?this.$axios.post("customers/remark/"+this.$route.params.id,{remark:this.new_remark}).then((t=>{"success"===t.data.message&&(this.getDataFromApi(),this.$q.notify({type:"positive",message:"Remark updated"}),this.new_remark="",this.remarkDialog=!1)})):(this.new_remark="",this.remarkDialog=!1)},submitStatus(){this.$axios.post("customers/status/"+this.$route.params.id,{status:this.status}).then((t=>{"success"===t.data.message&&(this.getDataFromApi(),this.$q.notify({type:"positive",message:"Status updated"}),this.statusDialog=!1)}))},getDataFromApi(){this.$q.loading.show(),this.$axios.get("customers/"+this.$route.params.id).then((t=>{this.name=t.data.name,this.status=t.data.status,this.type=t.data.type,this.gst_number=t.data.gst_number,this.addresses=t.data.addresses,this.linked=t.data.linked,this.representatives=t.data.representatives,this.tags=t.data.tags,this.emails=t.data.emails,this.default_shipping=t.data.default_shipping,this.remarks=t.data.remarks,this.created_at=t.data.created_at,this.updated_at=t.data.updated_at})).finally((()=>{this.$store.commit("setPageTitle","Leads: "+this.name),this.$q.loading.hide()}))},getLocaleString(t){if(t){const e=new Date(t);return e.toLocaleString()}return""},convert(){this.$axios.get("customers/convert/"+this.$route.params.id).then((t=>{"success"===t.data.message&&this.$router.push({path:"/customers/view/"+this.$route.params.id})})).catch((t=>{422===t.response.status&&this.$q.notify({type:"negative",message:"Data incomlete"})}))}}},o=n,d=a("2877"),c=a("9989"),u=a("f09f"),m=a("a370"),p=a("2bb1"),_=a("9c40"),g=a("24e8"),h=a("d66b"),b=a("4b7e"),v=a("9f0a"),k=a("eebe"),f=a.n(k),q=Object(d["a"])(o,s,r,!1,null,null,null);e["default"]=q.exports;f()(q,"components",{QPage:c["a"],QCard:u["a"],QCardSection:m["a"],QMarkupTable:p["a"],QBtn:_["a"],QDialog:g["a"],QEditor:h["a"],QCardActions:b["a"],QOptionGroup:v["a"]})}}]);