(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"32b0":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("page-toolbar",{attrs:{buttons:t.toolbarButtons},on:{save:function(e){return t.saveFn()},sendtoaccounts:function(e){return t.sendtoaccounts()},sendforconfirmation:function(e){return t.sendforconfirmation()}}}),s("breadcrumbs",{attrs:{breadcrumbs:t.breadcrumbs}}),s("div",{class:t.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[s("q-card",[s("q-card-section",[s("div",{class:t.$q.screen.gt.sm?"row q-col-gutter-md":"row q-col-gutter-xs"},[s("div",{class:t.$q.screen.gt.sm?"col-md-6 col-12 q-mt-md":"col-md-6 col-12 q-mt-xs"},[s("q-select",{ref:"customer",attrs:{dense:"",filled:"",square:"",label:"Customer","use-input":"","fill-input":"","hide-selected":"",options:t.customerOptions,"option-value":"id","option-label":"name",rules:[function(t){return!!t.name||"Required"}],tabindex:"1"},on:{filter:t.customerFilterFn,input:t.onInputCustomer},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                      No results\n                      ")])],1)]},proxy:!0}]),model:{value:t.model.customer,callback:function(e){t.$set(t.model,"customer",e)},expression:"model.customer"}})],1),s("div",{class:t.$q.screen.gt.sm?"col-md-6 col-12 q-mt-md":"col-md-6 col-12 q-mt-xs"},[s("q-select",{ref:"representative",attrs:{dense:"",label:"Representative","option-value":"id","option-label":"name",filled:"",square:"",options:t.representativeOptions,rules:[function(t){return!!t.name||"Required"}],tabindex:"2"},model:{value:t.model.representative,callback:function(e){t.$set(t.model,"representative",e)},expression:"model.representative"}})],1)]),t.model.billing_address&&"OTC"!=t.model.customer.name?s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 col-md-6 q-mt-md q-pa-sm"},[s("q-card",[s("q-card-section",{staticClass:"bg-blue-10 text-white"},[s("div",{staticClass:"text-subtitle2 "},[t._v("Billing Address")])]),s("q-card-section",[s("div",{staticClass:"text-subtitle1"},[t._v(t._s(t.model.billing_address))])])],1)],1),s("div",{staticClass:"col-12 col-md-6 q-mt-md q-pa-sm"},[s("q-card",[s("q-card-section",{staticClass:"bg-orange-10 text-white"},[s("div",{staticClass:"text-subtitle2 "},[t._v("Shipping Address")])]),s("q-card-section",[s("div",{staticClass:"text-subtitle1"},[t._v(t._s(t.model.shipping_address.content))])])],1),s("q-btn",{staticClass:"q-mt-md",attrs:{color:"blue-10",label:"New"},on:{click:t.openShippingDialog}}),s("q-btn",{staticClass:"q-mt-md q-ml-md",attrs:{color:"orange-10",label:"select"},on:{click:function(e){t.addressSelectionDialog=!0}}})],1)]):t._e(),s("div",{staticClass:"row q-col-gutter-md q-mt-xs"},[s("div",{staticClass:"col-md col-12"},[s("q-select",{ref:"pricelist",attrs:{dense:"",label:"Pricelist","option-value":"id","option-label":"name",filled:"",square:"",options:t.pricelists,rules:[function(t){return!!t||"Required"}],tabindex:"3"},model:{value:t.model.pricelist,callback:function(e){t.$set(t.model,"pricelist",e)},expression:"model.pricelist"}})],1),s("div",{staticClass:"col-md col-12"},[s("q-select",{ref:"warehouse",attrs:{dense:"",label:"Warehouse","option-value":"id","option-label":"name",filled:"",square:"",options:t.warehouses,rules:[function(t){return!!t||"Required"}],tabindex:"4"},model:{value:t.model.warehouse,callback:function(e){t.$set(t.model,"warehouse",e)},expression:"model.warehouse"}})],1),s("div",{staticClass:"col-md col-12"},[s("q-select",{ref:"source",attrs:{dense:"",label:"Source",filled:"",square:"",options:t.sources,rules:[function(t){return!!t||"Required"}],tabindex:"5"},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                    No results\n                  ")])],1)]},proxy:!0}]),model:{value:t.model.source,callback:function(e){t.$set(t.model,"source",e)},expression:"model.source"}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"Dentodeal"==t.model.source,expression:"model.source == 'Dentodeal'"}],staticClass:"col-md col-12"},[s("q-input",{ref:"order_no",attrs:{label:"Order No",filled:"",square:"",dense:"",rules:[function(e){return!(!e&&"Dentodeal"==t.model.source)||"Required"}],tabindex:"6"},model:{value:t.model.order_no,callback:function(e){t.$set(t.model,"order_no",e)},expression:"model.order_no"}})],1),s("div",{staticClass:"col-md col-12"},[s("q-select",{ref:"created_by_id",attrs:{dense:"",label:"Created By","option-value":"id","option-label":"name",filled:"",square:"",rules:[function(t){return!!t.name||"Required"}],options:t.createdByOptions,tabindex:"6"},model:{value:t.model.created_by,callback:function(e){t.$set(t.model,"created_by",e)},expression:"model.created_by"}})],1)]),"Export"!=t.model.type?s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-checkbox",{attrs:{label:"Rate Includes GST ?",color:"green-10",tabindex:"7"},model:{value:t.model.rate_includes_gst,callback:function(e){t.$set(t.model,"rate_includes_gst",e)},expression:"model.rate_includes_gst"}}),s("q-checkbox",{attrs:{label:"Include Flood Cess ?",color:"orange-10",tabindex:"7",disable:""},model:{value:t.model.flood_cess_included,callback:function(e){t.$set(t.model,"flood_cess_included",e)},expression:"model.flood_cess_included"}}),s("q-checkbox",{attrs:{label:"OTC",color:"accent",tabindex:"7"},model:{value:t.model.otc,callback:function(e){t.$set(t.model,"otc",e)},expression:"model.otc"}}),t.model.otc?t._e():s("q-checkbox",{attrs:{label:"COD",color:"teal-10",tabindex:"7"},on:{input:function(e){t.model.cod_charge=0}},model:{value:t.model.cod,callback:function(e){t.$set(t.model,"cod",e)},expression:"model.cod"}})],1)]):t._e(),s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-table",{attrs:{columns:t.columns,title:"Items",data:t.model.items,"wrap-cells":"",loading:t.table_loading,"rows-per-page-options":[0],filter:t.search},scopedSlots:t._u([{key:"body",fn:function(e){return[s("q-tr",{attrs:{props:e}},[s("q-td",{staticClass:"text-right"},[t._v(t._s(e.rowIndex+1))]),s("q-td",[t._v("\n                    "+t._s(e.row.product.name)+"\n                    "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close"},on:{hide:function(){e.row.gst=t.gst,e.row.tax_amount=t.rate_includes_gst?0:parseFloat(t.gst)/100*parseFloat(e.row.rate),t.product=null,t.gst=null},show:function(){t.product=e.row.product.name}},model:{value:e.row.product.name,callback:function(s){t.$set(e.row.product,"name",s)},expression:"props.row.product.name"}},[s("q-select",{attrs:{filled:"",square:"",dense:"",label:"Product",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand",options:t.productOptions,"use-input":"","fill-input":"","hide-selected":"",loading:t.prodLoading,"option-value":"id","option-label":"name"},on:{filter:t.productFilter,input:function(s){e.row.product=t.product}},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                              No results\n                            ")])],1)]},proxy:!0}],null,!0),model:{value:t.product,callback:function(e){t.product=e},expression:"product"}})],1),s("q-btn",{attrs:{flat:"",icon:"visibility",round:"",size:"sm"},on:{click:function(s){return s.stopPropagation(),t.showMaskDetails(e.row,e.rowIndex)}}},[s("q-tooltip",[t._v("View Masking Details")])],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(e.row.gst)+"%\n                    "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close"},on:{hide:function(s){return t.updateRow(e.rowIndex)}},model:{value:e.row.gst,callback:function(s){t.$set(e.row,"gst",s)},expression:"props.row.gst"}},[s("q-select",{attrs:{options:t.gstOptions,"map-options":"","emit-value":"",dense:"",autofocus:""},model:{value:e.row.gst,callback:function(s){t.$set(e.row,"gst",s)},expression:"props.row.gst"}})],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(e.row.qty)+"\n                    "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(e){return!0===t.qtyEditValidation(e)}},on:{hide:function(s){t.updateRow(e.rowIndex),e.row.qty=parseInt(e.row.qty)}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}},[s("q-input",{ref:"qty_edit",attrs:{rules:[t.qtyEditValidation],dense:"",autofocus:""},on:{input:function(e){return t.$refs.qty_edit.resetValidation()}},model:{value:e.row.qty,callback:function(s){t.$set(e.row,"qty",s)},expression:"props.row.qty"}})],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(t.currencySymbol)+t._s(e.row.rate)+"\n                    "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close",validate:function(e){return!0===t.rateEditValidation(e)}},on:{hide:function(s){t.updateRow(e.rowIndex),e.row.rate=parseFloat(e.row.rate).toFixed(2)}},model:{value:e.row.rate,callback:function(s){t.$set(e.row,"rate",s)},expression:"props.row.rate"}},[s("q-input",{ref:"rate_edit",attrs:{rules:[t.rateEditValidation],dense:"",autofocus:""},on:{input:function(e){return t.$refs.rate_edit.resetValidation()}},model:{value:e.row.rate,callback:function(s){t.$set(e.row,"rate",s)},expression:"props.row.rate"}})],1)],1),s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(e.row.expiry_date)+"\n                    "),s("q-popup-edit",{attrs:{buttons:"","label-set":"Save","label-cancel":"Close"},on:{show:function(s){return t.getExpiryOptions(e.row.product.id)},hide:function(e){t.expiryOptions=[]}},model:{value:e.row.expiry_date,callback:function(s){t.$set(e.row,"expiry_date",s)},expression:"props.row.expiry_date"}},[s("q-select",{attrs:{"option-value":"expiry_date","option-label":"expiry_date","emit-value":"",options:t.expiryOptions,dense:"",autofocus:""},model:{value:e.row.expiry_date,callback:function(s){t.$set(e.row,"expiry_date",s)},expression:"props.row.expiry_date"}})],1)],1),t.model.rate_includes_gst?t._e():s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(t.currencySymbol)+t._s(e.row.taxable)+"\n                  ")]),t.model.rate_includes_gst?t._e():s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(t.currencySymbol)+t._s(e.row.tax_amount)+"\n                  ")]),s("q-td",{staticClass:"text-right"},[t._v("\n                    "+t._s(t.currencySymbol)+t._s(e.row.total)+"\n                  ")]),s("q-td",{staticClass:"text-right"},[s("q-btn",{attrs:{round:"",icon:"delete",flat:"",color:"black"},on:{click:function(s){return t.deleteFn(e.rowIndex)}}})],1)],1)]}},{key:"top-right",fn:function(){return[s("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})]},proxy:!0}])})],1)]),s("div",{staticClass:"row q-col-gutter-xs q-mt-xs"},[s("div",{staticClass:"col-4"},[s("q-select",{ref:"product",attrs:{filled:"",square:"",dense:"",label:"Product",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand",options:t.productOptions,"option-value":"id","option-label":"name","use-input":"","fill-input":"","hide-selected":"",loading:t.prodLoading,tabindex:"8"},on:{filter:t.productFilter,"input-value":function(e){return t.$refs.product.resetValidation()},input:function(e){return t.$refs.gst.resetValidation()}},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                    No results\n                  ")])],1)]},proxy:!0}]),model:{value:t.product,callback:function(e){t.product=e},expression:"product"}})],1),"Export"===t.model.type?s("div",{},[s("q-checkbox",{attrs:{label:"Use Mask?"},model:{value:t.useMask,callback:function(e){t.useMask=e},expression:"useMask"}})],1):t._e(),s("div",{staticClass:"col"},[s("q-select",{ref:"gst",attrs:{filled:"",square:"",dense:"",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand",options:t.gstOptions,label:"GST","map-options":"","emit-value":"",tabindex:"-1"},model:{value:t.gst,callback:function(e){t.gst=e},expression:"gst"}})],1),s("div",{staticClass:"col"},[s("q-input",{ref:"qty",staticClass:"input-right",attrs:{filled:"",square:"",dense:"",label:"Qty",rules:[t.qtyValidation],"lazy-rules":"ondemand",hint:t.product?t.stock&&t.stock>0?t.stock+" Available":"Out of stock":"",tabindex:"9"},on:{focus:function(e){t.qty&&e.target.select()},blur:function(){t.qty=t.qty?parseInt(t.qty).toString():null},input:function(e){return t.$refs.qty.resetValidation()}},model:{value:t.qty,callback:function(e){t.qty=e},expression:"qty"}})],1),s("div",{staticClass:"col"},[s("q-input",{ref:"rate",staticClass:"input-right",attrs:{filled:"",square:"",dense:"",prefix:t.currencySymbol,label:"Rate",rules:[t.rateValidation],"lazy-rules":"ondemand",tabindex:"10"},on:{focus:function(e){t.rate&&e.target.select()},blur:function(){t.rate=t.rate?parseFloat(t.rate).toFixed(2):null}},model:{value:t.rate,callback:function(e){t.rate=e},expression:"rate"}})],1),t.model.rate_includes_gst?t._e():s("div",{staticClass:"col"},[s("q-input",{attrs:{filled:"",square:"",dense:"",prefix:t.currencySymbol,readonly:"",label:"Taxable",tabindex:"-1"},model:{value:t.row_taxable,callback:function(e){t.row_taxable=e},expression:"row_taxable"}})],1),t.model.rate_includes_gst?t._e():s("div",{staticClass:"col"},[s("q-input",{attrs:{filled:"",square:"",dense:"",prefix:t.currencySymbol,readonly:"",label:"Tax Amount",tabindex:"-1"},model:{value:t.row_tax_amount,callback:function(e){t.row_tax_amount=e},expression:"row_tax_amount"}})],1),s("div",{staticClass:"col"},[s("q-input",{attrs:{filled:"",square:"",dense:"",prefix:t.currencySymbol,readonly:"",label:"Total",tabindex:"-1"},model:{value:t.row_total,callback:function(e){t.row_total=e},expression:"row_total"}})],1),s("div",{},[s("q-btn",{attrs:{icon:"add",round:"",flat:"",color:"teal",tabindex:"11"},on:{click:function(e){return t.addRowValidation()}}})],1)]),s("div",{staticClass:"row q-col-gutter-md"},[s("div",{staticClass:"col-12 col-md-4"},[t.useMask?s("q-input",{attrs:{filled:"",dense:"",label:"Mask Name"},model:{value:t.maskName,callback:function(e){t.maskName=e},expression:"maskName"}}):t._e()],1)]),s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col-12 col-md-10"},[s("q-btn",{attrs:{color:"primary",label:"add bundle"},on:{click:function(e){t.bundleDialog=!0}}})],1),s("div",{staticClass:"col-12 col-md-2"},[s("div",{staticClass:"column"},[s("div",{staticClass:"col"},[s("q-input",{ref:"subtotal",staticClass:"input-right",attrs:{label:"Subtotal(Incl GST)",prefix:t.currencySymbol,dense:"",filled:"",square:"",readonly:"",rules:[function(t){return t>0||"Invalid"},function(t){return!isNaN(t)||"Invalid"}],tabindex:"-1"},model:{value:t.model.subtotal,callback:function(e){t.$set(t.model,"subtotal",e)},expression:"model.subtotal"}})],1),s("div",{staticClass:"col"},[s("q-input",{ref:"discount",staticClass:"input-right",attrs:{label:"Discount",prefix:t.currencySymbol,dense:"",filled:"",square:"",rules:[function(t){return!isNaN(t)||"Invalid"}],tabindex:"12"},model:{value:t.model.discount,callback:function(e){t.$set(t.model,"discount",e)},expression:"model.discount"}})],1),s("div",{staticClass:"col"},[s("q-input",{ref:"freight",staticClass:"input-right",attrs:{label:"Freight",prefix:t.currencySymbol,dense:"",filled:"",square:"",rules:[function(t){return!isNaN(t)||"Invalid"}],tabindex:"13"},model:{value:t.model.freight,callback:function(e){t.$set(t.model,"freight",e)},expression:"model.freight"}})],1),t.model.cod?s("div",{staticClass:"col"},[s("q-input",{ref:"freight",staticClass:"input-right",attrs:{label:"COD Charge",prefix:t.currencySymbol,dense:"",filled:"",square:"",rules:[function(t){return!isNaN(t)||"Invalid"}],tabindex:"13"},model:{value:t.model.cod_charge,callback:function(e){t.$set(t.model,"cod_charge",e)},expression:"model.cod_charge"}})],1):t._e(),s("div",{staticClass:"col"},[s("q-input",{ref:"round",staticClass:"input-right",attrs:{label:"Round",prefix:t.currencySymbol,dense:"",filled:"",square:"",rules:[function(t){return!isNaN(t)||"Invalid"}],tabindex:"14"},model:{value:t.model.round,callback:function(e){t.$set(t.model,"round",e)},expression:"model.round"}})],1),s("div",{staticClass:"col"},[s("q-input",{ref:"total",staticClass:"input-right",attrs:{label:"Total",prefix:t.currencySymbol,dense:"",filled:"",readonly:"",square:"",rules:[function(t){return t>0||"Invalid"},function(t){return!isNaN(t)||"Invalid"}],tabindex:"-1"},model:{value:t.model.total,callback:function(e){t.$set(t.model,"total",e)},expression:"model.total"}})],1)])])]),s("div",{staticClass:"text-subtitle1"},[t._v(" Additional Information")]),s("div",{staticClass:"row q-mt-sm q-col-gutter-md"},[s("div",{staticClass:"col-12 col-md-3"},[s("q-input",{attrs:{label:"PO Number",filled:"",square:"",dense:"",tabindex:"15"},model:{value:t.model.po_number,callback:function(e){t.$set(t.model,"po_number",e)},expression:"model.po_number"}})],1),s("div",{staticClass:"col-12 col-md-3"},[s("q-input",{attrs:{filled:"",dense:"",mask:"####-##-##",label:"Order Date",rules:[t.dateValidation],hint:"Format yyyy-mm-dd. Click on icon to select date",tabindex:"16"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[s("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-date",{model:{value:t.model.order_date,callback:function(e){t.$set(t.model,"order_date",e)},expression:"model.order_date"}},[s("div",{staticClass:"row items-center justify-end"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.model.order_date,callback:function(e){t.$set(t.model,"order_date",e)},expression:"model.order_date"}})],1)]),s("div",{staticClass:"row q-col-gutter-md"},[s("div",{staticClass:"col-12 col-md-6"},[s("div",{staticClass:"text-h6 q-mt-md"},[t._v("Remarks")]),s("q-editor",{attrs:{"min-height":"5rem",tabindex:"17"},model:{value:t.model.remarks,callback:function(e){t.$set(t.model,"remarks",e)},expression:"model.remarks"}})],1),s("div",{staticClass:"col-12 col-md-6"},[s("div",{staticClass:"text-h6 q-mt-md"},[t._v("Dentodeal Data")]),s("div",{domProps:{innerHTML:t._s(t.model.dentodeal_data)}})])])])],1)],1),s("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:t.toolbarButtons},on:{save:function(e){return t.saveFn()},sendtoaccounts:function(e){return t.sendtoaccounts()},sendforconfirmation:function(e){return t.sendforconfirmation()}}}),s("q-dialog",{attrs:{"full-width":"",persistent:""},model:{value:t.shippingDialog,callback:function(e){t.shippingDialog=e},expression:"shippingDialog"}},[s("q-card",[s("q-bar",{attrs:{dark:""}},[s("q-space"),s("q-btn",{attrs:{dense:"",flat:"",icon:"close"},on:{click:t.closeShippigDialog}},[s("q-tooltip",[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-checkbox",{staticClass:"q-mx-md",attrs:{label:"Set as default?",color:"blue-10"},model:{value:t.new_shipping_address.set_as_default,callback:function(e){t.$set(t.new_shipping_address,"set_as_default",e)},expression:"new_shipping_address.set_as_default"}})],1)]),s("div",{staticClass:"row q-col-gutter-md"},[s("div",{staticClass:"col-xs-12 col-md-6"},[s("div",{staticClass:"row q-mt-md"},[s("div",{staticClass:"col"},[s("q-input",{ref:"new_shipping_address_line_1",attrs:{square:"",filled:"",label:"Line 1",rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand"},on:{blur:function(e){t.new_shipping_address.line_1=t.capitaliseFn(t.new_shipping_address.line_1)}},model:{value:t.new_shipping_address.line_1,callback:function(e){t.$set(t.new_shipping_address,"line_1",e)},expression:"new_shipping_address.line_1"}})],1)])]),s("div",{staticClass:"col-xs-12 col-md-6"},[s("div",{staticClass:"row q-mt-md"},[s("div",{staticClass:"col"},[s("q-input",{attrs:{square:"",filled:"",label:"Line 2"},on:{blur:function(e){t.new_shipping_address.line_2=t.capitaliseFn(t.new_shipping_address.line_2)}},model:{value:t.new_shipping_address.line_2,callback:function(e){t.$set(t.new_shipping_address,"line_2",e)},expression:"new_shipping_address.line_2"}})],1)])])]),s("div",{staticClass:"row q-col-gutter-md"},[s("div",{staticClass:"col-xs-12 col-md-3"},[s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-input",{ref:"new_shipping_address_pin",attrs:{square:"",filled:"",label:"Pin / Zip Code",rules:[t.shippingPinRule],"lazy-rules":"ondemand"},model:{value:t.new_shipping_address.pin,callback:function(e){t.$set(t.new_shipping_address,"pin",e)},expression:"new_shipping_address.pin"}})],1)])]),s("div",{staticClass:"col-xs-12 col-md-3"},[s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-select",{ref:"new_shipping_address_country",attrs:{"use-input":"","fill-input":"","hide-selected":"",square:"",filled:"",options:t.country_options,rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand","option-label":"name","option-value":"id",label:"Country"},on:{filter:t.countryfilterFn,input:t.loadShippingState},model:{value:t.new_shipping_address.country,callback:function(e){t.$set(t.new_shipping_address,"country",e)},expression:"new_shipping_address.country"}})],1)])]),s("div",{staticClass:"col-xs-12 col-md-3"},[s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},[s("q-select",{ref:"new_shipping_address_state",attrs:{"use-input":"","fill-input":"","hide-selected":"",square:"",filled:"",options:t.state_options,loading:t.new_shipping_address_state_loading,rules:[function(t){return!!t||"Required"}],"lazy-rules":"ondemand","option-label":"name","option-value":"id",label:"State"},on:{filter:t.statefilterFn,input:t.loadShippingDistrict},model:{value:t.new_shipping_address.state,callback:function(e){t.$set(t.new_shipping_address,"state",e)},expression:"new_shipping_address.state"}})],1)])]),s("div",{staticClass:"col-xs-12 col-md-3"},[s("div",{staticClass:"row q-mt-xs"},[s("div",{staticClass:"col"},["India"!=t.new_shipping_address.country?s("q-input",{ref:"new_shipping_address_district",attrs:{square:"",filled:"",label:"District"},on:{blur:function(e){t.new_shipping_address.district=t.capitaliseFn(t.new_shipping_address.district)}},model:{value:t.new_shipping_address.district,callback:function(e){t.$set(t.new_shipping_address,"district",e)},expression:"new_shipping_address.district"}}):s("q-select",{ref:"new_shipping_address_district",attrs:{"use-input":"","fill-input":"","hide-selected":"",square:"",filled:"",rules:[t.shippingDistrictRule],"lazy-rules":"ondemand",options:t.district_options,"option-label":"name","option-value":"id",loading:t.new_shipping_address_district_loading,label:"District"},on:{filter:t.districtfilterFn},model:{value:t.new_shipping_address.district,callback:function(e){t.$set(t.new_shipping_address,"district",e)},expression:"new_shipping_address.district"}})],1)])])]),t._l(t.new_shipping_address.phones,(function(e,i){return s("div",{key:i,staticClass:"row q-col-gutter-md "},[s("div",{staticClass:"col-xs-12 col-md-6"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-3"},[s("q-select",{attrs:{options:t.phonecodes,"emit-value":"",filled:"",square:"",label:"Code"},model:{value:t.new_shipping_address.phones[i].country_code,callback:function(e){t.$set(t.new_shipping_address.phones[i],"country_code",e)},expression:"new_shipping_address.phones[index].country_code"}})],1),s("q-input",{ref:"shipping_phone_"+i,refInFor:!0,staticClass:"col-7",attrs:{label:"Phone "+(i+1),filled:"",square:"","error-message":t.new_shipping_address_phones_errors[i].message,error:t.new_shipping_address_phones_errors[i].message.length>0},on:{input:t.validateShippingPhones},model:{value:t.new_shipping_address.phones[i].content,callback:function(e){t.$set(t.new_shipping_address.phones[i],"content",e)},expression:"new_shipping_address.phones[index].content"}}),s("div",{staticClass:"col-2"},[t.new_shipping_address.phones.length>1?s("q-btn",{staticClass:"q-mt-sm",attrs:{icon:"delete",round:"",flat:""},on:{click:function(e){t.new_shipping_address.phones.splice(i,1),t.new_shipping_address_phones_errors.splice(i,1)}}}):t._e()],1)],1)])])})),s("q-btn",{attrs:{color:"secondary",label:"Add Phone",flat:""},on:{click:function(e){return t.addShippingPhone()}}})],2),s("q-card-actions",[s("q-btn",{attrs:{label:"Submit",color:"green"},on:{click:t.addShipping}})],1)],1)],1),s("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.addressSelectionDialog,callback:function(e){t.addressSelectionDialog=e},expression:"addressSelectionDialog"}},[s("q-card",{staticClass:"bg-primary text-white"},[s("q-bar",[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[s("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v("Select shipping address")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"row q-col-gutter-md"},[t._l(t.addresses,(function(e,i){return["shipping"==e.tag_name?s("div",{key:i,staticClass:"col-md-4 col-12"},[s("q-card",{staticClass:"bg-white text-black",attrs:{dark:""}},[s("q-card-section",[t._v("\n                  "+t._s(e.content)+"\n                ")]),s("q-card-actions",[s("q-btn",{attrs:{label:"Select",color:"orange-10"},on:{click:function(s){t.model.shipping_address=e,t.addressSelectionDialog=!1}}})],1)],1)],1):t._e()]}))],2)])],1)],1),s("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.bundleDialog,callback:function(e){t.bundleDialog=e},expression:"bundleDialog"}},[s("q-card",{staticClass:"bg-blue text-white"},[s("q-bar",[s("q-space"),s("q-btn",{attrs:{dense:"",flat:"",icon:"close"},on:{click:t.closeBundleDialog}},[s("q-tooltip",{attrs:{"content-class":"bg-white text-blue"}},[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v("Select Product Bundle")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("q-card",[s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-select",{ref:"search_bundle",attrs:{filled:"",square:"",dense:"",label:"Search Bundle",options:t.bundleOptions,"option-value":"id","option-label":"name","use-input":"","fill-input":"","hide-selected":"",loading:t.bundleLoading},on:{filter:t.bundleFilter},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n                        No results\n                      ")])],1)]},proxy:!0}]),model:{value:t.bundle,callback:function(e){t.bundle=e},expression:"bundle"}})],1)]),s("div",{staticClass:"text-h6 text-grey-8 q-my-sm"},[t._v("Bundle Items")]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-markup-table",[s("thead",[s("tr",[s("th",{staticClass:"text-right"},[t._v("#")]),s("th",{staticClass:"text-left"},[t._v("Product")]),s("th",{staticClass:"text-right"},[t._v("Qty")]),s("th",{staticClass:"text-right"},[t._v(t._s(this.model.rate_includes_gst?"Rate(Incl GST)":"Rate(Excl GST)"))]),s("th",{staticClass:"text-right"})])]),s("tbody",[t.bundleItems.length>0?t._l(t.bundleItems,(function(e,i){return s("tr",{key:i},[s("td",{staticClass:"text-right"},[t._v(t._s(i+1))]),s("td",{staticClass:"text-left"},[t._v(t._s(e.product.name))]),s("td",[s("q-input",{ref:"bundle_qty",refInFor:!0,staticClass:"input-right",attrs:{filled:"",square:"",dense:"",rules:[function(t){return!!t||"Required"},function(t){return Number.isInteger(t)||"Invalid"}]},on:{focus:function(e){return t.$refs.bundle_qty[i].select()}},model:{value:t.bundleItems[i].qty,callback:function(e){t.$set(t.bundleItems[i],"qty",t._n(e))},expression:"bundleItems[i].qty"}})],1),s("td",[s("q-input",{ref:"bundle_rate",refInFor:!0,staticClass:"input-right",attrs:{filled:"",square:"",dense:"",rules:[function(t){return!!t||"Required"},function(t){return!isNaN(t)||"Invalid"}]},on:{focus:function(e){return t.$refs.bundle_rate[i].select()}},model:{value:t.bundleItems[i].rate,callback:function(e){t.$set(t.bundleItems[i],"rate",e)},expression:"bundleItems[i].rate"}})],1),s("td",{staticClass:"text-right"},[s("q-btn",{attrs:{round:"",flat:"",icon:"delete",size:"sm",tabindex:"-1"},on:{click:function(e){return t.bundleItems.splice(i,1)}}})],1)])})):[s("tr",[s("td",{staticClass:"text-center text-subtitle1",attrs:{colspan:"5"}},[t._v("\n                          No items\n                        ")])])]],2)])],1)])]),s("q-card-actions",[s("q-space"),s("q-btn",{attrs:{color:"secondary",flat:"",label:"cancel",tabindex:"-1"},on:{click:t.closeBundleDialog}}),s("q-btn",{attrs:{color:"primary",label:"Add Items"},on:{click:t.addBundleItems}})],1)],1)],1)],1)],1),s("q-dialog",{model:{value:t.maskDialog,callback:function(e){t.maskDialog=e},expression:"maskDialog"}},[s("q-card",{staticStyle:{width:"500px"}},[s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-checkbox",{attrs:{label:"Use Mask?"},model:{value:t.useMask,callback:function(e){t.useMask=e},expression:"useMask"}})],1)]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("q-input",{attrs:{filled:"",dense:"",label:"Mask Name"},model:{value:t.maskName,callback:function(e){t.maskName=e},expression:"maskName"}})],1)])]),s("q-card-section",[s("q-btn",{attrs:{flat:"",color:"primary","no-caps":"",label:"Ok"},on:{click:t.closeMaskDialog}})],1)],1)],1)],1)},a=[],o=(s("c975"),s("a434"),s("e6cf"),s("a79d"),s("5319"),s("ddb0"),s("ded3")),n=s.n(o),l=s("a89c"),r=s("b6c6"),d={name:"SaleOrdersCreate",components:{PageToolbar:l["a"],Breadcrumbs:r["a"]},data(){return{useMask:!1,maskName:null,maskDialog:!1,maskEditIndex:null,model:{currency:"INR",rate_includes_gst:!0,serial_no:null,customer:{name:null,id:null,non_billable_account:!1,status:null},warehouse:{name:null,id:null},pricelist:{name:null,id:null},items:[],source:null,subtotal:0,total:0,round:0,discount:0,freight:0,flood_cess_included:!1,representative:{name:null,id:null},remarks:"",dentodeal_data:"",status:"Draft",shipping_address:{content:null},billing_address:null,created_by:{name:null,id:null},otc:!1,cod:!1,cod_charge:0,order_no:null,po_number:null,order_date:null},bundleDialog:!1,customerOptions:[],warehouses:[],pricelists:[],sources:["Apexion","Dentodeal"],representativeOptions:[],addresses:[],search:null,table_loading:!1,product:null,prodLoading:!1,productOptions:[],bundle:null,bundleLoading:!1,bundleOptions:[],bundleItems:[],gst:null,qty:null,rate:null,expiry_data:null,stock:null,expiryOptions:[],cost:null,min_margin:0,row_taxable:null,row_tax_amount:null,row_total:null,expirable:!1,new_shipping_address:{set_as_default:!1,line_1:null,line_2:null,pin:null,district:null,state:null,country:"",phones:[{id:1,content:"",country_code:"+91"}]},new_shipping_address_district_loading:!1,new_shipping_address_state_loading:!1,new_shipping_address_phones_errors:[{message:""}],shippingDialog:!1,country_options:[],state_options:[],district_options:[],countries:[],phonecodes:[],gstOptions:[],createdByOptions:[],addressSelectionDialog:!1,saveBtnLoading:!1}},mounted(){if(this.$store.getters.hasPermissionTo("create_sale_order")){this.$q.loading.show();const t=["create_sale_order","update_sale_order"];Promise.all([this.$axios.get("warehouses").then((t=>{this.warehouses=t.data.model,1===this.warehouses.length&&(this.model.warehouse=this.warehouses[0])})),this.$axios.get("pricelists").then((t=>{this.pricelists=t.data.model,1===this.pricelists.length&&(this.model.pricelist=this.pricelists[0])})),this.$axios.get("representatives").then((t=>{this.representativeOptions=t.data})),this.$axios.get("countries").then((t=>{this.countries=t.data})),this.$axios.get("phonecodes").then((t=>{this.phonecodes=t.data})),this.$axios.get("gst_options").then((t=>{this.gstOptions=t.data})),this.$axios.get("users/has_permission?permissions="+encodeURIComponent(JSON.stringify(t))).then((t=>{this.createdByOptions=t.data}))]).finally((()=>{this.$q.loading.hide(),"Draft"!==this.model.status&&this.$router.push({name:"Error403"})})),this.$route.params.id?(this.$q.loading.show(),this.$axios.get("sale_orders/"+this.$route.params.id).then((t=>{this.model=t.data,t.data.remarks||(this.model.remarks=""),t.data.dentodeal_data||(this.model.dentodeal_data="")})).finally((()=>{this.$q.loading.hide(),"Draft"!==this.model.status&&this.$router.push({name:"Error403"})}))):this.$route.query.duplicate&&(this.$q.loading.show(),this.$axios.get("sale_orders/"+this.$route.query.duplicate).then((t=>{Object.keys(t.data).forEach((e=>{"status"!==e&&(this.model[e]=t.data[e])}))})).finally((()=>{this.$q.loading.hide(),this.$q.notify({message:"Note!!. This sale order is not saved yet.",color:"blue-10"})}))),this.$route.params.customer_id&&this.$axios.get("customers/"+this.$route.params.customer_id).then((t=>{"Active"===t.data.status||"Approved"===t.data.status?(this.model.customer={name:t.data.name,id:t.data.id},"OTC"!==t.data.name&&this.onInputCustomer()):(this.$q.notify({message:"Cannot create sale order for given customer. Contact CRO",type:"info"}),this.$router.push("/"))}))}else this.$router.push({name:"Error403"})},methods:{showMaskDetails(t,e){this.maskName=t.mask_name,this.useMask=t.use_mask,this.maskEditIndex=e,this.maskDialog=!0},closeMaskDialog(){this.model.items[this.maskEditIndex].use_mask=this.useMask,this.model.items[this.maskEditIndex].mask_name=this.maskName,this.useMask=!1,this.maskName=null,this.maskEditIndex=null,this.maskDialog=!1},addBundleItems(){let t=!0,e=!0;this.$refs.bundle_qty.forEach((e=>{t=e.validate()})),this.$refs.bundle_rate.forEach((t=>{e=t.validate()})),t&&e?(this.$q.loading.show(),this.bundleItems.forEach((t=>{const e=parseInt(t.qty),s=parseFloat(t.rate),i=parseFloat(t.product.gst);let a=0,o=0,n=0;this.model.rate_includes_gst?n=s*e:(a=s*e,o=a*(i/100),n=a+o),-1!==this.$_.findIndex(this.model.items,(e=>e.product.id===t.product.id))?this.$q.dialog({title:"Duplicate Entry  !!",message:"Duplicate entry detected for: "+t.product.name+". Proceed?",ok:{label:"Yes. Add"},cancel:{label:"No. Don't Add"}}).onOk((()=>{this.model.items.push({product:t.product,expirable:!1,gst:t.product.gst,qty:e,rate:s,expiry_date:null,taxable:a.toFixed(2),tax_amount:o.toFixed(2),total:n.toFixed(2),stock:0,cost:0,min_margin:0}),this.addtoSubtotal(n)})):(this.model.items.push({product:t.product,expirable:!1,gst:t.product.gst,qty:e,rate:s,expiry_date:null,taxable:a.toFixed(2),tax_amount:o.toFixed(2),total:n.toFixed(2),stock:0,cost:0,min_margin:0}),this.addtoSubtotal(n))})),this.$q.loading.hide(),this.closeBundleDialog()):this.$q.notify({message:"Invalid data given.",type:"negative"})},addRowValidation(){this.$refs.product.validate()&this.$refs.gst.validate()&this.$refs.qty.validate()&this.$refs.rate.validate()&&("object"===typeof this.product&&-1!==this.$_.findIndex(this.model.items,(t=>t.product.id===this.product.id))?this.$q.dialog({title:"Duplicate Entry !!",message:"This product is already entered. Would you like to continue?",cancel:!0,persistent:!0,ok:{label:"Continue"}}).onOk((()=>{this.cost>0&&parseFloat(this.rate)<parseFloat(this.cost)?this.$q.dialog({title:"Warning",message:"The rate you entered is less than cost["+this.cost+"]",cancel:!0}).onOk((()=>{this.addRow()})):this.addRow()})):this.cost>0&&this.rate<this.cost?this.$q.dialog({title:"Warning",message:"The rate you entered is less than cost ["+this.cost+"]. Continue?",cancel:!0}).onOk((()=>{this.addRow()})):this.addRow())},addRow(){if(this.expirable&&this.expiryOptions.length>0){let t=parseInt(this.qty);const e=this.$_.groupBy(this.$_.filter(this.model.items,(t=>null==t.id)),"product.id");e[this.product.id]&&e[this.product.id].length>0&&e[this.product.id].forEach((t=>{this.expiryOptions.forEach(((e,s)=>{t.qty<e.qty?this.expiryOptions[s].qty=parseInt(e.qty)-parseInt(t.qty):this.expiryOptions.splice(s,1)}))})),this.expiryOptions.forEach((e=>{t>parseInt(e.qty)?(t-=parseInt(e.qty),this.addItem(parseInt(e.qty),e.expiry_date)):t>0&&(this.addItem(parseInt(t),e.expiry_date),t=0)})),t>0&&this.addItem(t)}else this.addItem(this.qty);this.product=null,this.gst=null,this.qty=null,this.rate=null,this.row_discount=null,this.row_taxable=null,this.row_tax_amount=null,this.row_total=null,this.stock=null,this.expiryOptions=[],this.expiry_data=null,this.cost=null,this.min_margin=0,this.$nextTick((()=>{this.$refs.product.focus()}))},addItem(t,e=null){t=parseInt(t);const s=this.rate?parseFloat(this.rate):0,i=this.gst?parseFloat(this.gst):0;let a=0,o=0,n=0;this.model.rate_includes_gst?n=s*t:(a=s*t,o=a*(i/100),n=a+o),this.model.items.push({product:this.product,expirable:this.expirable,gst:this.gst,qty:t,rate:this.rate,expiry_date:e,taxable:a.toFixed(2),tax_amount:o.toFixed(2),total:n.toFixed(2),stock:this.stock,cost:this.cost,min_margin:this.min_margin}),this.addtoSubtotal(n)},addtoSubtotal(t){this.model.subtotal=(parseFloat(this.model.subtotal)+parseFloat(t)).toFixed(2)},deleteFn(t){this.$q.dialog({title:"Confirm",message:"Would you like to delete this record?",cancel:!0,persistent:!0}).onOk((()=>{const e=parseFloat(this.model.items[t].total);this.model.subtotal=parseFloat(this.model.subtotal)-e,this.model.items[t].id&&this.$route.params.id?(this.$q.loading.show(),this.$axios.get("sale_orders/delete_item/"+this.model.items[t].id).then((e=>{"success"===e.data.message&&this.model.items.splice(t,1)})).finally((()=>{this.$q.loading.hide()}))):this.model.items.splice(t,1)})).onCancel((()=>{}))},updateRow(t){const e=parseFloat(this.model.items[t].total),s=parseInt(this.model.items[t].qty),i=parseFloat(this.model.items[t].rate),a=parseFloat(this.model.items[t].gst);let o=0;if(this.model.rate_includes_gst)o=i*s,this.model.items[t].total=o.toFixed(2);else{let e=0;e=i*s,this.model.items[t].taxable=e.toFixed(2);let n=0;n=e*(a/100),this.model.items[t].tax_amount=n.toFixed(2),o=e+n,this.model.items[t].total=o.toFixed(2)}const n=o-e;this.addtoSubtotal(n)},updateTotal(){const t=parseFloat(this.model.subtotal),e=parseFloat(this.model.discount),s=parseFloat(this.model.freight),i=parseFloat(this.model.cod_charge),a=parseFloat(this.model.round),o=t-e+s+i+a;this.model.total=o.toFixed(2)},customerFilterFn(t,e,s){t&&this.$axios.get("customers_search?billable=1&search="+encodeURIComponent(t)).then((t=>{e((()=>{this.customerOptions=t.data}))}))},qtyValidation(){return null===this.qty||""===this.qty?"Required":isNaN(this.qty)?"Invalid":!(parseInt(this.qty)<=0)||"Qty must be greater than 0"},rateValidation(){return null===this.rate||""===this.rate?"Required":!isNaN(this.rate)||"Invalid"},qtyEditValidation(t){return t?isNaN(t)?"invalid":!!Number.isInteger(Number(t))||"Must be Integer":"Required"},rateEditValidation(t){return t?isNaN(t)?"Invalid":!(parseFloat(t)<0)||"Invalid":"Required"},updateFields(){const t=this.qty?parseInt(this.qty):0,e=this.rate?parseFloat(this.rate):0,s=this.gst?parseFloat(this.gst):0;if(this.model.rate_includes_gst)this.row_total=(e*t).toFixed(2);else{let i=0;i=e*t,this.row_taxable=i.toFixed(2);let a=0;a=i*(s/100),this.row_tax_amount=a.toFixed(2);const o=i+a;this.row_total=o.toFixed(2)}},productFilter(t,e,s){t&&(this.prodLoading=!0,this.$axios.get("products/search?keyword="+encodeURIComponent(t)).then((t=>{e((()=>{this.productOptions=t.data}))})).finally((()=>{this.prodLoading=!1})))},bundleFilter(t,e,s){e((()=>{t&&(this.bundleLoading=!0,this.$axios.get("product_bundles/search?keyword="+encodeURIComponent(t)).then((t=>{this.bundleOptions=t.data})).finally((()=>{this.bundleLoading=!1})))}))},openShippingDialog(){this.new_shipping_address.country="India",this.loadShippingState(),this.shippingDialog=!0},closeShippigDialog(){this.resetShippingPhonesErrors(),this.resetShippingAddress(),this.shippingDialog=!1},resetShippingAddress(){this.new_shipping_address.set_as_default=!1,this.new_shipping_address.line_1=null,this.new_shipping_address.line_2=null,this.new_shipping_address.pin=null,this.new_shipping_address.district="",this.new_shipping_address.district_loading=!1,this.new_shipping_address.state=null,this.new_shipping_address.state_loading=!1,this.new_shipping_address.country="",this.new_shipping_address.phones=[{id:1,content:"",country_code:"+91"}],this.shippingDialog=!1},resetShippingPhonesErrors(){this.new_shipping_address_phones_errors.forEach(((t,e)=>{this.$set(this.new_shipping_address_phones_errors[e],"message","")}))},shippingPinRule(t){return"India"!==this.new_shipping_address.country||(t?isNaN(t)?"PIN must be numeric":6===t.length||"PIN must be exactly 6 digits":"Required")},shippingDistrictRule(t){return"India"!==this.new_shipping_address.country||(t&&t.length>0||"Required")},loadShippingState(t=1){t&&(this.new_shipping_address.state=null,this.new_shipping_address.district=null),this.new_shipping_address_state_loading=!0,this.getStates(this.new_shipping_address.country).finally((()=>{this.new_shipping_address_state_loading=!1}))},getStates(t){return this.$axios.get("states/"+encodeURIComponent(t)).then((t=>{this.states=t.data}))},loadShippingDistrict(t=1){t&&(this.new_shipping_address.district=null),this.new_shipping_address_district_loading=!0,this.getDistricts(this.new_shipping_address.state).finally((()=>{this.new_shipping_address_district_loading=!1}))},getDistricts(t){return this.$axios.get("districts/"+encodeURIComponent(t)).then((t=>{this.districts=t.data}))},countryfilterFn(t,e,s){e((()=>{const e=t.toLocaleLowerCase();this.country_options=this.countries.filter((t=>t.toLocaleLowerCase().indexOf(e)>-1))}))},statefilterFn(t,e,s){e((()=>{const e=t.toLocaleLowerCase();this.state_options=this.states.filter((t=>t.toLocaleLowerCase().indexOf(e)>-1))}))},districtfilterFn(t,e,s){e((()=>{const e=t.toLocaleLowerCase();this.district_options=this.districts.filter((t=>t.toLocaleLowerCase().indexOf(e)>-1))}))},validateShippingPhones(){this.resetShippingPhonesErrors();let t=!1;return this.new_shipping_address.phones.forEach(((e,s)=>{"India"===this.new_shipping_address.country?e.content?isNaN(e.content)?(this.$set(this.new_shipping_address_phones_errors[s],"message","Phone must be numeric."),t=!1):10!==e.content.length?(this.$set(this.new_shipping_address_phones_errors[s],"message","Phone must be 10 digits."),t=!1):t=!0:(this.$set(this.new_shipping_address_phones_errors[s],"message","Required"),t=!1):e.content?isNaN(e.content)?(this.$set(this.new_shipping_address_phones_errors[s],"message","Phone must be numeric."),t=!1):t=!0:(this.$set(this.new_shipping_address_phones_errors[s],"message","Required"),t=!1)})),t},addShippingPhone(){this.new_shipping_address.phones.push({id:this.new_shipping_address.phones.length+1,content:"",country_code:"+91"}),this.new_shipping_address_phones_errors.push({message:""}),this.$nextTick((()=>{const t=this.new_shipping_address.phones.length-1,e="shipping_phone_"+t;this.$refs[e][0].focus()}))},addShipping(){if(this.$refs.new_shipping_address_line_1.validate()&this.$refs.new_shipping_address_pin.validate()&this.$refs.new_shipping_address_country.validate()&this.$refs.new_shipping_address_state.validate()&this.$refs.new_shipping_address_district.validate()&this.validateShippingPhones()){const t=this.$_.cloneDeep(this.new_shipping_address);this.$axios.post("customers/add_shipping/"+this.customer.id,t).then((e=>{if("success"===e.data.message){t.id=e.data.id;const s=this.addressFormat(t),i={id:e.data.id,tag_name:"shipping",content:s};this.model.shipping_address=i,this.addresses.push(i),this.closeShippigDialog()}}))}},addressFormat(t){let e="";return e+=t.line_1+", ",t.line_2&&(e+=t.line_2+", "),t.district&&(e+=t.district+", "),e+=t.state+", ",t.pin&&(e+="PIN: "+t.pin+", "),e+=t.country+", ",e+="Ph: ",t.phones.forEach((t=>{e+="("+t.country_code+")"+t.content+", "})),e=e.substr(0,e.length-2),e},capitaliseFn(t){if(t){const e=t.split(" ");for(let t=0;t<e.length;t++)e[t]=e[t].charAt(0).toUpperCase()+e[t].substring(1);return e.join(" ")}return""},sendtoaccounts(){this.saveFn("Invoice Pending")},sendforconfirmation(){this.saveFn("Pending Confirmation")},saveFn(t="Draft"){if(this.saveBtnLoading=!0,this.$refs.customer.validate()&this.$refs.representative.validate()&this.$refs.pricelist.validate()&this.$refs.warehouse.validate()&this.$refs.created_by_id.validate()&this.$refs.source.validate()&this.$refs.order_no.validate()&this.validateItemsCount()){let e=0;this.model.items.forEach((t=>{e+=parseFloat(t.total)})),this.model.subtotal=e;const s=this.model;s.status=t,s._method=this.$route.params.id?"PUT":"POST";let i="sale_orders";this.$route.params.id&&(i="sale_orders/"+this.$route.params.id),this.$q.loading.show(),this.$axios.post(i,s).then((t=>{"success"===t.data.message&&(this.$q.loading.hide(),this.$q.notify({type:"positive",message:"Saved Succesfully."}),this.$router.replace("/sale_orders/view/"+t.data.id))})).catch((t=>{if(this.$q.loading.hide(),422===t.response.status){this.$q.notify({type:"negative",message:t.response.data.message});let e='<div class="q-markup-table q-table__container q-table__card q-table--horizontal-separator q-table--no-wrap"><table class="q-table">';e+="<thead><tr>",e+='<th class="text-left">Line</th>',e+='<th class="text-left">Product</th>',e+='<th class="text-right">Exp</th>',e+='<th class="text-right">Given</th>',e+='<th class="text-right">Available</th>',e+="</tr></thead><tbody>",Object.keys(t.response.data.errors).forEach((s=>{if(-1!==s.indexOf("items")){const i=t.response.data.errors[s][0].split("?");e+="<tr>",e+='<td class="text-left">'+(parseInt(s.substr(s.indexOf(".")+1))+1)+"</td>",e+='<td class="text-left">'+i[0]+"</td>",e+='<td class="text-right">'+i[1]+"</td>",e+='<td class="text-right">'+i[2]+"</td>",e+='<td class="text-right">'+i[3]+"</td>",e+="</tr>"}})),e+="</tbody></table></div>",this.$q.dialog({style:{width:"50%",maxWidth:"100%"},title:"Cannot process this Sale Order. Following errors occured",message:e,html:!0})}})).finally((()=>{this.saveBtnLoading=!1,this.$q.loading.hide()}))}else this.saveBtnLoading=!1,this.$q.notify({type:"negative",message:"Invalid data given !!!"})},validateItemsCount(){return this.model.items.length>0||(this.$q.notify({type:"negative",message:"There should be atleast one item"}),!1)},onInputCustomer(t){console.log(t),"Disabled"===t.status?(this.model.customer={name:null,id:null,non_billable_account:!1,status:null},this.$q.dialog({title:"Attention",message:"The customer selected was disabled by CRO. Please contact CRO."})):"Active"!==t.status&&"Approved"!==t.status?(this.model.customer={name:null,id:null,non_billable_account:!1,status:null},this.$q.dialog({title:"Attention",message:"The customer selected is not active or approved by CRO. Please contact CRO."})):"OTC"===t.name?this.model.otc=!0:(this.model.otc=!1,this.$q.loading.show(),this.model.shipping_address={content:null},this.model.billing_address=null,this.$axios.get("customer_addresses/"+this.model.customer.id).then((t=>{1===t.data.representatives.length&&(this.model.representative=t.data.representatives[0]),this.addresses=t.data.addresses.map((e=>{const s=this.addressFormat(e);return"billing"===e.tag_name&&(this.model.billing_address=s),"shipping"===e.tag_name&&t.data.default_shipping===e.id&&(this.model.shipping_address={id:e.id,tag_name:e.tag_name,content:s}),{id:e.id,tag_name:e.tag_name,content:s}}))})).finally((()=>{this.$q.loading.hide()})))},getExpiryOptions(t){this.$axios.get("products/basic/"+t+"/"+this.model.warehouse.id).then((t=>{this.expiryOptions=t.data.expiry_options,this.cost=t.data.cost}))},dateValidation(t){return t?!!/^-?[\d]+-[0-1]\d-[0-3]\d$/.test(t)||"Invalid Date":"Required"},closeBundleDialog(){this.bundleItems=[],this.bundle=null,this.bundleOptions=[],this.bundleDialog=!1}},computed:{currencySymbol(){return"INR"===this.model.currency?"₹":"$"},toolbarButtons(){const t=[];return!this.$store.getters.hasPermissionTo("send_to_accounts_sale_order")||this.model.cod||this.model.customer.non_billable_account||t.push({label:"Send to Accounts",id:"sendtoaccounts",type:"button",color:"blue-10",icon:"forward"}),"Dentodeal"!==this.source||this.model.customer.non_billable_account||t.push({label:"Send for Confirmation",id:"sendforconfirmation",type:"button",color:"blue-10",icon:"forward"}),t.push({label:"Save as Draft",id:"save",type:"button",color:"teal",icon:"save"}),t},breadcrumbs(){const t=[{label:"Dashboard",link:"/"},{label:"Sale Orders",link:"/sale_orders"},{label:this.$route.params.id?this.model.serial_no:"Create",link:"/sale_orders/view/"+this.$route.params.id}];return this.$route.params.id&&t.push({label:"Edit",link:""}),t},columns(){const t=[{name:"sl_no",field:"sl_no",label:"#",sortable:!1},{name:"name",field:"name",label:"Product",sortable:!1,align:"left"},{name:"gst",field:"gst",label:"GST",sortable:!1},{name:"qty",field:"qty",label:"Qty",sortable:!1},{name:"rate",field:"rate",label:"Rate",sortable:!1},{name:"expiry_date",field:"expiry_date",label:"Expiry Date",sortable:!1}];return this.model.rate_includes_gst||t.push({name:"taxable",field:"taxable",label:"Taxable",sortable:!1},{name:"tax_amount",field:"tax_amount",label:"Tax Amount",sortable:!1}),t.push({name:"total",field:"total",label:"Total",sortable:!1},{name:"actions",field:"actions",label:"",sortable:!1}),t},customer(){return this.model.customer},subtotal(){return this.model.subtotal},cod_charge(){return this.model.cod_charge},discount(){return this.model.discount},freight(){return this.model.freight},round(){return this.model.round},rate_includes_gst(){return this.model.rate_includes_gst},flood_cess_included(){return this.model.flood_cess_included}},watch:{product(t,e){t&&"object"===typeof t&&this.model.warehouse.id&&this.$axios.get("products/basic/"+t.id+"/"+this.model.warehouse.id).then((t=>{this.gst=t.data.gst,this.expirable=t.data.expirable,this.row_weight=t.data.weight,this.hsn=t.data.hsn,this.mrp=t.data.mrp;const e=this.$_.sumBy(this.model.items,(t=>t.product.id!==this.product.id||t.id?0:parseInt(t.qty)));this.stock=e>0?parseInt(t.data.available_stock)-e:t.data.available_stock,this.expiryOptions=t.data.expiry_options,this.cost=t.data.cost?t.data.cost:0,this.min_margin=t.data.min_margin?t.data.min_margin:0}))},bundle(t,e){t&&"object"===typeof t&&this.$axios.get("product_bundles/items/"+t.id).then((t=>{this.bundleItems=t.data.items.map((t=>n()(n()({},t),{},{rate:0})))}))},qty(t,e){this.updateFields()},rate(t,e){this.updateFields()},row_discount(t,e){this.updateFields()},gst(t,e){this.updateFields()},subtotal(){this.updateTotal()},cod_charge(){this.updateTotal()},discount(){this.updateTotal()},freight(){this.updateTotal()},round(){this.updateTotal()},rate_includes_gst(t,e){if(t){this.$q.loading.show();let t=0;this.model.items.forEach(((e,s)=>{let i=0;const a=parseFloat(e.rate),o=parseInt(e.qty);i=o*a,t+=parseFloat(i.toFixed(2)),this.model.items[s].total=i.toFixed(2)})),this.model.subtotal=t,this.$q.loading.hide()}else{this.$q.loading.show();let t=0;this.model.items.forEach(((e,s)=>{let i=0,a=0,o=0;const n=parseFloat(e.rate),l=parseInt(e.qty),r=parseFloat(e.gst);a=n*l,o=a*(r/100),i=a+o,this.model.items[s].taxable=a.toFixed(2),this.model.items[s].tax_amount=o.toFixed(2),this.model.items[s].total=i.toFixed(2),t+=parseFloat(i)})),this.model.subtotal=t.toFixed(2),this.$q.loading.hide()}}}},c=d,u=s("2877"),p=s("9989"),h=s("f09f"),m=s("a370"),_=s("ddd8"),g=s("66e5"),b=s("4074"),f=s("9c40"),q=s("27f9"),x=s("8f8e"),v=s("eaac"),w=s("bd08"),y=s("db86"),C=s("42a1"),k=s("05c0"),$=s("0016"),I=s("7cbe"),F=s("52ee"),S=s("d66b"),D=s("24e8"),O=s("d847"),N=s("2c91"),R=s("4b7e"),P=s("2bb1"),E=s("7f67"),T=s("eebe"),L=s.n(T),Q=Object(u["a"])(c,i,a,!1,null,null,null);e["default"]=Q.exports;L()(Q,"components",{QPage:p["a"],QCard:h["a"],QCardSection:m["a"],QSelect:_["a"],QItem:g["a"],QItemSection:b["a"],QBtn:f["a"],QInput:q["a"],QCheckbox:x["a"],QTable:v["a"],QTr:w["a"],QTd:y["a"],QPopupEdit:C["a"],QTooltip:k["a"],QIcon:$["a"],QPopupProxy:I["a"],QDate:F["a"],QEditor:S["a"],QDialog:D["a"],QBar:O["a"],QSpace:N["a"],QCardActions:R["a"],QMarkupTable:P["a"]}),L()(Q,"directives",{ClosePopup:E["a"]})}}]);