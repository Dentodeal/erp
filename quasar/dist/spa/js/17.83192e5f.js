(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{f9f6:function(s,e,t){"use strict";t.r(e);var a=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("q-page",[t("page-toolbar",{attrs:{"page-title":"Create User",buttons:s.toolbarButtons},on:{save:function(e){return s.saveFn()},"change-password":function(e){s.changePasswordDialog=!0}}}),t("breadcrumbs",{attrs:{breadcrumbs:s.breadcrumbs}}),t("div",{class:s.$q.screen.gt.sm?"q-px-lg":"q-px-xs"},[t("q-card",[t("q-card-section",[t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-md-4"},[t("q-toggle",{attrs:{label:"Active"},model:{value:s.active,callback:function(e){s.active=e},expression:"active"}})],1)]),t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-md-4"},[t("q-input",{attrs:{outlined:"",dense:"",square:"",label:"Name","error-message":s.errors.name,error:s.errors.name&&s.errors.name.length>0},on:{input:function(e){s.errors.name=null}},model:{value:s.name,callback:function(e){s.name=e},expression:"name"}})],1)]),t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-md-4"},[t("q-input",{attrs:{outlined:"",dense:"",square:"",label:"E-mail","error-message":s.errors.email,error:s.errors.email&&s.errors.email.length>0},on:{input:function(e){s.errors.email=null}},model:{value:s.email,callback:function(e){s.email=e},expression:"email"}})],1)]),s.$route.params.id?s._e():t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-md-4"},[t("q-input",{attrs:{outlined:"",dense:"",square:"",label:"Password",type:s.isPwd?"password":"text","error-message":s.errors.password,error:s.errors.password&&s.errors.password.length>0},on:{input:function(e){s.errors.password=null}},scopedSlots:s._u([{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:s.isPwd?"visibility_off":"visibility"},on:{click:function(e){s.isPwd=!s.isPwd}}})]},proxy:!0}],null,!1,3635466494),model:{value:s.password,callback:function(e){s.password=e},expression:"password"}})],1)]),t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12 col-md-4"},[t("q-select",{attrs:{options:s.roleOptions,outlined:"",dense:"",square:"",multiple:"",label:"Roles","error-message":s.errors.roles,error:s.errors.roles&&s.errors.roles.length>0,"option-value":"id","option-label":"name"},on:{input:function(e){s.errors.roles=null,s.updatePermissions()}},model:{value:s.roles,callback:function(e){s.roles=e},expression:"roles"}})],1)])])],1)],1),t("div",{class:s.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[t("q-card",[t("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:s.tab,callback:function(e){s.tab=e},expression:"tab"}},[t("q-tab",{attrs:{name:"permissions",label:"Permissions"}}),t("q-tab",{attrs:{name:"notifications",label:"Notification Subscriptions"}})],1),t("q-separator"),t("q-tab-panels",{attrs:{animated:""},model:{value:s.tab,callback:function(e){s.tab=e},expression:"tab"}},[t("q-tab-panel",{attrs:{name:"permissions"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[s._v("Permissions")]),s.errors.permissions&&s.errors.permissions.length>0?t("q-banner",{staticClass:"text-white bg-red",attrs:{"inline-actions":""},scopedSlots:s._u([{key:"action",fn:function(){return[t("q-btn",{attrs:{flat:"",color:"white",label:"Dismiss"},on:{click:function(e){s.errors.permissions=null}}})]},proxy:!0}],null,!1,3306209236)},[s._v("\n                  Permissions should not be empty\n                  ")]):s._e(),t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12"},[t("q-btn",{attrs:{label:"Select All",tile:"",dark:"",color:"primary"},on:{click:function(e){return s.selectAll()}}}),t("q-btn",{staticClass:"q-ml-md",attrs:{label:"Reset",tile:"",dark:"",color:"secondary"},on:{click:function(e){return s.resetFn()}}})],1)]),s._l(s.$_.groupBy(s.permissionsCollection,"model"),(function(e,a){return[t("div",{key:a,staticClass:"row q-mt-sm q-col-gutter-md"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"text-h5"},[s._v(s._s(a))])]),s._l(e,(function(e,a){return t("div",{key:a},[t("q-checkbox",{attrs:{label:e.name,val:e.id},model:{value:s.permissions,callback:function(e){s.permissions=e},expression:"permissions"}})],1)}))],2),t("q-separator",{key:a+"a",staticClass:"q-mt-md"})]}))],2)],1),t("q-tab-panel",{attrs:{name:"notifications"}},[t("q-card-section",[t("div",{staticClass:"row q-mt-sm"},[t("div",{staticClass:"col-12"},[t("q-btn",{attrs:{label:"Select All",tile:"",dark:"",color:"primary"},on:{click:function(e){return s.selectAllNotifications()}}}),t("q-btn",{staticClass:"q-ml-md",attrs:{label:"Reset",tile:"",dark:"",color:"secondary"},on:{click:function(e){return s.resetNotifications()}}})],1)]),t("q-markup-table",[t("thead",[t("th"),t("th",{staticClass:"text-left"},[s._v("Name")]),t("th",{staticClass:"text-left"},[s._v("Description")])]),t("tbody",s._l(s.notificationCollection,(function(e,a){return t("q-tr",{key:a},[t("q-td",[t("q-checkbox",{attrs:{val:e.id},model:{value:s.notification_types,callback:function(e){s.notification_types=e},expression:"notification_types"}})],1),t("q-td",[s._v(s._s(e.name))]),t("q-td",[s._v(s._s(e.description))])],1)})),1)])],1)],1)],1)],1)],1),s.$route.params.id?t("q-dialog",{attrs:{persistent:"",position:"bottom"},model:{value:s.changePasswordDialog,callback:function(e){s.changePasswordDialog=e},expression:"changePasswordDialog"}},[t("q-card",{staticStyle:{width:"500px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[s._v("Change Password")]),t("q-input",{attrs:{outlined:"",dense:"",square:"",label:"New Password",type:"password","error-message":s.errors.password,error:s.errors.password&&s.errors.password.length>0},on:{input:function(e){s.errors.password=null}},model:{value:s.password,callback:function(e){s.password=e},expression:"password"}})],1),t("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"red"}}),t("q-btn",{attrs:{flat:"",label:"Save"},on:{click:function(e){return s.changePassword()}}})],1)],1)],1):s._e()],1)},i=[],o=(t("e6cf"),t("a79d"),t("ddb0"),t("a89c")),r=t("b6c6"),n={name:"UsersCreate",components:{Breadcrumbs:r["a"],PageToolbar:o["a"]},mounted(){this.$store.getters.hasPermissionTo("create_user")?(this.$q.loading.show(),Promise.all([this.$axios.get("all-permissions").then((s=>{this.permissionsCollection=s.data})),this.$axios.get("user_roles").then((s=>{this.roleOptions=s.data.model})),this.$axios.get("notification_types").then((s=>{this.notificationCollection=s.data}))]).then((()=>{this.$route.params.id?this.$axios.get("users/"+this.$route.params.id).then((s=>{this.name=s.data.name,this.email=s.data.email,this.roles=s.data.roles,this.active=s.data.active,this.permissions=s.data.permissions,this.notification_types=Object.keys(this.$_.groupBy(s.data.notification_types,"id")).map(Number),this.toolbarButtons.unshift({label:"Change Password",id:"change-password",type:"button",color:"orange-9"})})).finally((()=>{this.$store.commit("setPageTitle","Edit User: "+this.name),this.$q.loading.hide()})):(this.$store.commit("setPageTitle","Create User"),this.$q.loading.hide())}))):this.$router.push({name:"Error403"})},data(){return{toolbarButtons:[{label:"Save",id:"save",type:"button",color:"teal"}],isPwd:!0,changePasswordDialog:!1,active:!0,name:null,email:null,password:null,roleOptions:[],permissionsCollection:[],notificationCollection:[],tab:"permissions",permissions:[],notification_types:[],roles:[],errors:{name:null,email:null,roles:null,password:null,permissions:null}}},computed:{breadcrumbs(){return[{label:"Dashboard",link:"/"},{label:"Users",link:"/users"},{label:this.$route.params.id?this.name:"Create",link:"",disabled:!0}]}},methods:{saveFn(){let s="users";this.$route.params.id&&(s="users/"+this.$route.params.id);const e={permissions:JSON.stringify(this.permissions),active:this.active,name:this.name,email:this.email,roles:JSON.stringify(Object.keys(this.$_.groupBy(this.roles,"id"))),_method:this.$route.params.id?"PUT":"POST"};this.$route.params.id||(e.password=this.password),this.$axios.post(s,e).then((s=>{"success"===s.data.message&&(this.$q.notify({type:"positive",message:"User Saved Successfully"}),this.$router.back())})).catch((s=>{422===s.response.status&&(this.$q.notify({type:"negative",message:s.response.data.message}),Object.keys(s.response.data.errors).forEach(((e,t)=>{this.errors[e]=s.response.data.errors[e][0]})))}))},changePassword(){this.$axios.post("users/"+this.$route.params.id,{password:this.password,_method:"PUT"}).then((s=>{"success"===s.data.message&&(this.$q.notify({type:"positive",message:"Password CHnaged Successfully"}),this.changePasswordDialog=!1)})).catch((s=>{422===s.response.status&&(this.$q.notify({type:"negative",message:s.response.data.message}),this.errors.password=s.response.data.errors.password[0])}))},selectAll(){this.permissionsCollection.forEach((s=>{this.permissions.push(s.id)}))},resetFn(){this.permissions=[]},updatePermissions(){this.resetFn(),this.$q.loading.show(),this.roles.forEach(((s,e)=>{this.$axios.get("user_roles/"+s.id).then((s=>{this.permissions=this.$_.uniq(this.$_.concat(this.permissions,Object.keys(this.$_.groupBy(s.data.permissions,"id"))).map(Number)),this.notification_types=this.$_.uniq(this.$_.concat(this.notification_types,Object.keys(this.$_.groupBy(s.data.notification_types,"id"))).map(Number))}))})),this.$q.loading.hide()}}},l=n,c=t("2877"),d=t("9989"),p=t("f09f"),m=t("a370"),u=t("9564"),h=t("27f9"),b=t("0016"),f=t("ddd8"),g=t("429b"),q=t("7460"),v=t("eb85"),w=t("adad"),y=t("823b"),C=t("54e1"),_=t("9c40"),k=t("8f8e"),$=t("2bb1"),x=t("bd08"),P=t("db86"),Q=t("24e8"),S=t("4b7e"),T=t("7f67"),N=t("eebe"),O=t.n(N),B=Object(c["a"])(l,a,i,!1,null,null,null);e["default"]=B.exports;O()(B,"components",{QPage:d["a"],QCard:p["a"],QCardSection:m["a"],QToggle:u["a"],QInput:h["a"],QIcon:b["a"],QSelect:f["a"],QTabs:g["a"],QTab:q["a"],QSeparator:v["a"],QTabPanels:w["a"],QTabPanel:y["a"],QBanner:C["a"],QBtn:_["a"],QCheckbox:k["a"],QMarkupTable:$["a"],QTr:x["a"],QTd:P["a"],QDialog:Q["a"],QCardActions:S["a"]}),O()(B,"directives",{ClosePopup:T["a"]})}}]);