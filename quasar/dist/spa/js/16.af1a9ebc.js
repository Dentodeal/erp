(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"3c42":function(s,e,t){"use strict";t.r(e);var i=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("q-page",[t("page-toolbar",{attrs:{buttons:s.toolbarButtons},on:{save:function(e){return s.saveFn()},sendtoaccounts:function(e){return s.sendToAccounts()}}}),t("breadcrumbs",{attrs:{breadcrumbs:s.breadcrumbs}}),t("div",{class:s.$q.screen.gt.sm?"q-px-lg q-mt-md":"q-px-xs q-mt-sm"},[t("q-card",[t("q-card-section",[t("div",{staticClass:"row q-col-gutter-md"},[t("div",{staticClass:"col-xs-12 col-md-6"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-input",{ref:"name",attrs:{square:"",dense:"",outlined:"",label:"Name",rules:[function(s){return!!s||"Required"}],"lazy-rules":"ondemand","error-message":s.errors.name,error:s.errors.name.length>0},on:{blur:function(e){s.name=s.capitaliseFn(s.name)}},model:{value:s.name,callback:function(e){s.name=e},expression:"name"}})],1)]),t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-input",{ref:"gst_number",attrs:{square:"",dense:"",outlined:"",label:"GST No.","error-message":s.gst_error_message,error:s.gst_error_message.length>0},model:{value:s.gst_number,callback:function(e){s.gst_number=e},expression:"gst_number"}})],1)])])]),s._l(s.emails,(function(e,i){return t("div",{key:i+"email",staticClass:"row q-col-gutter-md q-mt-xs"},[t("div",{staticClass:"col-xs-12 col-md-6"},[t("div",{staticClass:"row"},[t("q-input",{staticClass:"col-10",attrs:{dense:"",label:"Email "+(i+1),outlined:"",square:"","error-message":s.emails_errors[i].message,error:s.emails_errors[i].message.length>0},on:{input:s.validateEmails},model:{value:s.emails[i].content,callback:function(e){s.$set(s.emails[i],"content",e)},expression:"emails[index].content"}}),t("div",{staticClass:"col-2"},[s.emails.length>1?t("q-btn",{staticClass:"q-mt-sm",attrs:{icon:"delete",round:"",flat:""},on:{click:function(e){s.emails.splice(i,1),s.emails_errors.splice(i,1)}}}):s._e()],1)],1)])])})),t("div",{staticClass:"row"},[t("q-btn",{attrs:{color:"secondary",label:"Add Email",flat:""},on:{click:function(e){s.emails.push({id:s.emails.length+1,content:""}),s.emails_errors.push({message:""})}}})],1),t("div",{staticClass:"text-subtitle1 q-mt-xs"},[s._v(" Billing Address")]),t("div",{staticClass:"row q-col-gutter-md"},[t("div",{staticClass:"col-xs-12 col-md-6"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-input",{ref:"billing_address_line_1",attrs:{square:"",dense:"",outlined:"",label:"Line 1",rules:[function(s){return!!s||"Required"}],"lazy-rules":"ondemand"},on:{blur:function(e){s.billing_address.line_1=s.capitaliseFn(s.billing_address.line_1)}},model:{value:s.billing_address.line_1,callback:function(e){s.$set(s.billing_address,"line_1",e)},expression:"billing_address.line_1"}})],1)])]),t("div",{staticClass:"col-xs-12 col-md-6"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-input",{attrs:{square:"",dense:"",outlined:"",label:"Line 2"},on:{blur:function(e){s.billing_address.line_2=s.capitaliseFn(s.billing_address.line_2)}},model:{value:s.billing_address.line_2,callback:function(e){s.$set(s.billing_address,"line_2",e)},expression:"billing_address.line_2"}})],1)])])]),t("div",{staticClass:"row q-col-gutter-md"},[t("div",{staticClass:"col-xs-12 col-md-3"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-input",{ref:"billing_address_pin",attrs:{square:"",dense:"",outlined:"",label:"Pin / Zip Code",rules:[s.billingPinRule],"lazy-rules":"ondemand"},model:{value:s.billing_address.pin,callback:function(e){s.$set(s.billing_address,"pin",e)},expression:"billing_address.pin"}})],1)])]),t("div",{staticClass:"col-xs-12 col-md-3"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-select",{ref:"billing_address_country",attrs:{"use-input":"",dense:"","fill-input":"","hide-selected":"",square:"",outlined:"",options:s.country_options,rules:[function(s){return!!s||"Required"}],"lazy-rules":"ondemand","option-label":"name","option-value":"id",label:"Country"},on:{filter:s.countryfilterFn,input:s.loadBillingState},model:{value:s.billing_address.country,callback:function(e){s.$set(s.billing_address,"country",e)},expression:"billing_address.country"}})],1)])]),t("div",{staticClass:"col-xs-12 col-md-3"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},[t("q-select",{ref:"billing_address_state",attrs:{"use-input":"",dense:"","fill-input":"","hide-selected":"",square:"",outlined:"",disable:!s.billing_address.country,options:s.state_options,rules:[function(s){return!!s||"Required"}],"lazy-rules":"ondemand",loading:s.billing_address_state_loading,"option-label":"name","option-value":"id",label:"State"},on:{filter:s.statefilterFn,input:s.loadBillingDistrict},model:{value:s.billing_address.state,callback:function(e){s.$set(s.billing_address,"state",e)},expression:"billing_address.state"}})],1)])]),t("div",{staticClass:"col-xs-12 col-md-3"},[t("div",{staticClass:"row q-mt-xs"},[t("div",{staticClass:"col"},["India"!=s.billing_address.country?t("q-input",{ref:"billing_address.district",attrs:{square:"",dense:"",outlined:"",label:"District"},model:{value:s.billing_address.district,callback:function(e){s.$set(s.billing_address,"district",e)},expression:"billing_address.district"}}):t("q-select",{ref:"billing_address_district",attrs:{"use-input":"",dense:"","fill-input":"","hide-selected":"",square:"",outlined:"",disable:!s.billing_address.state,rules:[s.billingDistrictRule],"lazy-rules":"ondemand",options:s.district_options,"option-label":"name","option-value":"id",loading:s.billing_address_district_loading,label:"District"},on:{filter:s.districtfilterFn},model:{value:s.billing_address.district,callback:function(e){s.$set(s.billing_address,"district",e)},expression:"billing_address.district"}})],1)])])]),s._l(s.billing_address.phones,(function(e,i){return t("div",{key:i,staticClass:"row q-col-gutter-md"},[t("div",{staticClass:"col-xs-12 col-md-6"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-3"},[t("q-select",{attrs:{options:s.phonecodes,dense:"","emit-value":"",outlined:"",square:"",label:"Code"},model:{value:s.billing_address.phones[i].country_code,callback:function(e){s.$set(s.billing_address.phones[i],"country_code",e)},expression:"billing_address.phones[index].country_code"}})],1),t("q-input",{ref:"billing_phone_"+i,refInFor:!0,staticClass:"col-7",attrs:{label:"Phone "+(i+1),outlined:"",square:"",dense:"","error-message":s.billing_address_phones_errors[i].message,error:s.billing_address_phones_errors[i].message.length>0},on:{input:s.validateBillingPhones},model:{value:s.billing_address.phones[i].content,callback:function(e){s.$set(s.billing_address.phones[i],"content",e)},expression:"billing_address.phones[index].content"}}),t("div",{staticClass:"col-2"},[s.billing_address.phones.length>1?t("q-btn",{staticClass:"q-mt-sm",attrs:{icon:"delete",round:"",flat:""},on:{click:function(e){s.billing_address.phones.splice(i,1),s.billing_address_phones_errors.splice(i,1)}}}):s._e()],1)],1)])])})),t("q-btn",{attrs:{color:"secondary",label:"Add Phone",flat:""},on:{click:s.addBillingPhone}}),t("div",{staticClass:"text-subtitle1"},[s._v("Remarks")]),t("q-editor",{attrs:{"min-height":"5rem"},model:{value:s.remarks,callback:function(e){s.remarks=e},expression:"remarks"}})],2)],1)],1),t("page-toolbar",{staticClass:"q-mt-md",attrs:{"page-title":"",buttons:s.toolbarButtons},on:{save:function(e){return s.saveFn()},sendtoaccounts:function(e){return s.sendToAccounts()}}})],1)},a=[],l=(t("c975"),t("e6cf"),t("a79d"),t("ddb0"),t("a89c")),n=t("b6c6"),r={name:"CustomersCreate",components:{PageToolbar:l["a"],Breadcrumbs:n["a"]},data(){return{name:null,status:"Draft",gst_number:"",gst_error_message:"",errors:{name:""},emails:[{id:1,content:""}],emails_errors:[{message:""}],billing_address:{line_1:null,line_2:null,pin:null,district:null,state:null,country:"",phones:[{id:1,content:"",country_code:"+91"}]},billing_address_district_loading:!1,billing_address_state_loading:!1,billing_address_phones_errors:[{message:""}],district_options:[],state_options:[],country_options:[],countries:[],phonecodes:[],states:[],districts:[],remarks:""}},computed:{breadcrumbs(){const s=[{label:"Dashboard",link:"/"},{label:"Suppliers",link:"/suppliers"},{label:this.$route.params.id?this.name:"Create",link:"/suppliers/view/"+this.$route.params.id}];return this.$route.params.id&&s.push({label:"Edit",link:""}),s},toolbarButtons(){const s=[];return this.$store.getters.hasPermissionTo("tally_supplier")&&s.push({label:"Send to Accounts",id:"sendtoaccounts",type:"button",color:"blue-10",icon:"forward"}),s.push({label:"Save as Draft",id:"save",type:"button",color:"teal",icon:"save"}),s}},mounted(){this.$store.getters.hasPermissionTo("create_customer")?(this.$q.loading.show(),this.billing_address.country="India",this.loadBillingState(),Promise.all([this.$axios.get("countries").then((s=>{this.countries=s.data})),this.$axios.get("phonecodes").then((s=>{this.phonecodes=s.data}))]).then((()=>{this.$route.params.id?this.$axios.get("suppliers/"+this.$route.params.id).then((s=>{this.name=s.data.name,this.status=s.data.status,this.gst_number=s.data.gst_number,this.remarks=s.data.remarks?s.data.remarks:"";const e=[];s.data.emails.forEach((s=>{this.emails_errors.push({message:""}),e.push({id:s.id,content:s.content})})),e.length>0&&(this.emails=e),s.data.addresses.forEach((s=>{if("billing"===s.tag_name){const e=[];s.phones.forEach((s=>{this.billing_address_phones_errors.push({message:""}),e.push({id:s.id,content:s.content,country_code:s.country_code})})),this.billing_address={line_1:s.line_1,line_2:s.line_2,pin:s.pin,country:s.country,state:s.state,district:s.district,phones:e}}}))})).finally((()=>{this.$store.commit("setPageTitle","Edit Supplier : "+this.name)})):this.$store.commit("setPageTitle","Create Supplier")})).finally((()=>{this.$q.loading.hide()}))):this.$router.push({name:"Error403"})},methods:{countryfilterFn(s,e,t){e((()=>{const e=s.toLocaleLowerCase();this.country_options=this.countries.filter((s=>s.toLocaleLowerCase().indexOf(e)>-1))}))},statefilterFn(s,e,t){e((()=>{const e=s.toLocaleLowerCase();this.state_options=this.states.filter((s=>s.toLocaleLowerCase().indexOf(e)>-1))}))},districtfilterFn(s,e,t){e((()=>{const e=s.toLocaleLowerCase();this.district_options=this.districts.filter((s=>s.toLocaleLowerCase().indexOf(e)>-1))}))},billingPinRule(s){return"India"!==this.billing_address.country||(s?isNaN(s)?"PIN must be numeric":6===s.length||"PIN must be exactly 6 digits":"Required")},billingDistrictRule(s){return"India"!==this.billing_address.country||(s&&s.length>0||"Required")},resetBillingPhonesErrors(){this.billing_address_phones_errors.forEach(((s,e)=>{this.$set(this.billing_address_phones_errors[e],"message","")}))},resetEmails(){this.emails_errors.forEach(((s,e)=>{this.$set(this.emails_errors[e],"message","")}))},validateEmails(){let s=!1;this.resetEmails();const e=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return this.emails.forEach(((t,i)=>{t.content&&(e.test(String(t.content).toLowerCase())?s=!0:(this.$set(this.emails_errors[i],"message","Invalid Email"),s=!1)),s=!0})),s},validateGst(){return this.gst_error_message="",!(this.has_gst&&this.gst_number.length<1)||(this.gst_error_message="Required",!1)},saveFn(s="Draft"){if(this.validateFn()){this.errors.name="",this.emails_errors.forEach(((s,e)=>{this.emails_errors[e].message=""})),this.billing_address_phones_errors.forEach(((s,e)=>{this.billing_address_phones_errors[e].message=""}));const e={_method:this.$route.params.id?"PUT":"POST",status:s,remarks:this.remarks};e.name=this.name,e.gst_number=this.has_gst?this.gst_number:"",e.billing_address=this.billing_address,e.emails=this.emails;let t="suppliers";this.$route.params.id&&(t="suppliers/"+this.$route.params.id),this.$q.loading.show(),this.$axios.post(t,e).then((s=>{"success"===s.data.message&&(this.$q.loading.hide(),this.$q.notify({type:"positive",message:"Saved Succesfully."}),this.$router.back())})).catch((s=>{this.$q.loading.hide(),422===s.response.status&&(this.$q.notify({type:"negative",message:s.response.data.message}),Object.keys(s.response.data.errors).forEach(((e,t)=>{-1!==e.indexOf("emails")?this.emails_errors[Number(e.substr(e.indexOf("emails")+7))].message=s.response.data.errors[e][0]:-1!==e.indexOf("name")?this.errors.name=s.response.data.errors[e][0]:-1!==e.indexOf("billing_address.phones")&&(this.billing_address_phones_errors[Number(e.substr(e.indexOf("billing_address.phones")+23))].message=s.response.data.errors[e][0])})))})).finally((()=>{this.$q.loading.hide()}))}else this.$q.notify({type:"negative",message:"The form is incomplete. Please verify"})},sendToAccounts(){this.saveFn("Pending Activation")},validateFn(){return this.$refs.name.validate()&this.validateEmails()&this.validateGst()},loadBillingState(){this.billing_address.state=null,this.billing_address.district=null,this.billing_address_state_loading=!0,this.getStates(this.billing_address.country).finally((()=>{this.billing_address_state_loading=!1}))},getStates(s){return this.$axios.get("states/"+encodeURIComponent(s)).then((s=>{this.states=s.data}))},loadBillingDistrict(){this.billing_address.state&&(this.billing_address.district=null,this.billing_address_district_loading=!0,this.getDistricts(this.billing_address.state).finally((()=>{this.billing_address_district_loading=!1})))},getDistricts(s){return this.$axios.get("districts/"+encodeURIComponent(s)).then((s=>{this.districts=s.data}))},addBillingPhone(){this.billing_address.phones.push({id:this.billing_address.phones.length+1,content:"",country_code:"+91"}),this.billing_address_phones_errors.push({message:""}),this.$nextTick((()=>{const s=this.billing_address.phones.length-1,e="billing_phone_"+s;this.$refs[e][0].focus()}))},capitaliseFn(s){if(s){const e=s.split(" ");for(let s=0;s<e.length;s++)e[s]=e[s].charAt(0).toUpperCase()+e[s].substring(1);return e.join(" ")}return""}}},o=r,d=t("2877"),c=t("9989"),u=t("f09f"),m=t("a370"),g=t("27f9"),h=t("9c40"),_=t("ddd8"),b=t("d66b"),p=t("eebe"),f=t.n(p),v=Object(d["a"])(o,i,a,!1,null,null,null);e["default"]=v.exports;f()(v,"components",{QPage:c["a"],QCard:u["a"],QCardSection:m["a"],QInput:g["a"],QBtn:h["a"],QSelect:_["a"],QEditor:b["a"]})}}]);